<<<<<<< Updated upstream
P5_weekends <- P5 %>% dplyr::filter(weekdays_binary == 0)
#function for counting the number of pictures for each species
activity <- function(species, CT)
{
CT_species <- CT %>% filter(Species == species)
Unique_CT <- unique(CT_species$Station)
l <- list(0)
for(i in Unique_CT)
{
l[[which(Unique_CT == i)]] <-
nrow(CT_species %>% filter(Station == i))
#% of pictures taken during the night
names(l)[which(Unique_CT == i)] <- as.character(i)
}
x <- data.frame(unlist(l))
x <- dplyr::rename(x, activity = unlist.l.)
x <- x %>% mutate(User_uid = as.numeric(rownames(x)))
x_covenv <- dplyr::inner_join(x = x,
y = stacked_raster_values_and_garden_CT_all_seasons_no_nas,
by = c("User_uid" = "Station"))
#merging with the covenv
return(x_covenv)
}
## P1
squirrel_P1_activity_weekdays <- activity("Squirrel", P1_weekdays) %>%
mutate(species = "Squirrel", weekdays = 1)
squirrel_P1_activity_weekends <- activity("Squirrel", P1_weekends) %>%
mutate(species = "Squirrel", weekdays = 0)
cat_P1_activity_weekdays <- activity("Cat", P1_weekdays) %>%
mutate(species = "Cat", weekdays = 1)
cat_P1_activity_weekends <- activity("Cat", P1_weekends) %>%
mutate(species = "Cat", weekdays = 0)
fox_P1_activity_weekdays <- activity("Red Fox", P1_weekdays) %>%
mutate(species = "Red Fox", weekdays = 1)
fox_P1_activity_weekends <- activity("Red Fox", P1_weekends) %>%
mutate(species = "Red Fox", weekdays = 0)
marten_P1_activity_weekdays <- activity("Marten", P1_weekdays) %>%
mutate(species = "Marten", weekdays = 1)
marten_P1_activity_weekends <- activity("Marten", P1_weekends) %>%
mutate(species = "Marten", weekdays = 0)
raccoon_P1_activity_weekdays <- activity("Raccoon", P1_weekdays) %>%
mutate(species = "Raccoon", weekdays = 1)
raccoon_P1_activity_weekends <- activity("Raccoon", P1_weekends) %>%
mutate(species = "Raccoon", weekdays = 0)
## P2
squirrel_P2_activity_weekdays <- activity("Squirrel", P2_weekdays) %>%
mutate(species = "Squirrel", weekdays = 1)
squirrel_P2_activity_weekends <- activity("Squirrel", P2_weekends) %>%
mutate(species = "Squirrel", weekdays = 0)
cat_P2_activity_weekdays <- activity("Cat", P2_weekdays) %>%
mutate(species = "Cat", weekdays = 1)
cat_P2_activity_weekends <- activity("Cat", P2_weekends) %>%
mutate(species = "Cat", weekdays = 0)
fox_P2_activity_weekdays <- activity("Red Fox", P2_weekdays) %>%
mutate(species = "Red Fox", weekdays = 1)
fox_P2_activity_weekends <- activity("Red Fox", P2_weekends) %>%
mutate(species = "Red Fox", weekdays = 0)
marten_P2_activity_weekdays <- activity("Marten", P2_weekdays) %>%
mutate(species = "Marten", weekdays = 1)
marten_P2_activity_weekends <- activity("Marten", P2_weekends) %>%
mutate(species = "Marten", weekdays = 0)
raccoon_P2_activity_weekdays <- activity("Raccoon", P2_weekdays) %>%
mutate(species = "Raccoon", weekdays = 1)
raccoon_P2_activity_weekends <- activity("Raccoon", P2_weekends) %>%
mutate(species = "Raccoon", weekdays = 0)
## P3
squirrel_P3_activity_weekdays <- activity("Squirrel", P3_weekdays) %>%
mutate(species = "Squirrel", weekdays = 1)
squirrel_P3_activity_weekends <- activity("Squirrel", P3_weekends) %>%
mutate(species = "Squirrel", weekdays = 0)
cat_P3_activity_weekdays <- activity("Cat", P3_weekdays) %>%
mutate(species = "Cat", weekdays = 1)
cat_P3_activity_weekends <- activity("Cat", P3_weekends) %>%
mutate(species = "Cat", weekdays = 0)
fox_P3_activity_weekdays <- activity("Red Fox", P3_weekdays) %>%
mutate(species = "Red Fox", weekdays = 1)
fox_P3_activity_weekends <- activity("Red Fox", P3_weekends) %>%
mutate(species = "Red Fox", weekdays = 0)
marten_P3_activity_weekdays <- activity("Marten", P3_weekdays) %>%
mutate(species = "Marten", weekdays = 1)
marten_P3_activity_weekends <- activity("Marten", P3_weekends) %>%
mutate(species = "Marten", weekdays = 0)
raccoon_P3_activity_weekdays <- activity("Raccoon", P3_weekdays) %>%
mutate(species = "Raccoon", weekdays = 1)
raccoon_P3_activity_weekends <- activity("Raccoon", P3_weekends) %>%
mutate(species = "Raccoon", weekdays = 0)
#P4
squirrel_P4_activity_weekdays <- activity("Squirrel", P4_weekdays) %>%
mutate(species = "Squirrel", weekdays = 1)
squirrel_P4_activity_weekends <- activity("Squirrel", P4_weekends) %>%
mutate(species = "Squirrel", weekdays = 0)
cat_P4_activity_weekdays <- activity("Cat", P4_weekdays) %>%
mutate(species = "Cat", weekdays = 1)
cat_P4_activity_weekends <- activity("Cat", P4_weekends) %>%
mutate(species = "Cat", weekdays = 0)
fox_P4_activity_weekdays <- activity("Red Fox", P4_weekdays) %>%
mutate(species = "Red Fox", weekdays = 1)
fox_P4_activity_weekends <- activity("Red Fox", P4_weekends) %>%
mutate(species = "Red Fox", weekdays = 0)
marten_P4_activity_weekdays <- activity("Marten", P4_weekdays) %>%
mutate(species = "Marten", weekdays = 1)
marten_P4_activity_weekends <- activity("Marten", P4_weekends) %>%
mutate(species = "Marten", weekdays = 0)
raccoon_P4_activity_weekdays <- activity("Raccoon", P4_weekdays) %>%
mutate(species = "Raccoon", weekdays = 1)
raccoon_P4_activity_weekends <- activity("Raccoon", P4_weekends) %>%
mutate(species = "Raccoon", weekdays = 0)
#P5
squirrel_P5_activity_weekdays <- activity("Squirrel", P5_weekdays) %>%
mutate(species = "Squirrel", weekdays = 1)
squirrel_P5_activity_weekends <- activity("Squirrel", P5_weekends) %>%
mutate(species = "Squirrel", weekdays = 0)
cat_P5_activity_weekdays <- activity("Cat", P5_weekdays) %>%
mutate(species = "Cat", weekdays = 1)
cat_P5_activity_weekends <- activity("Cat", P5_weekends) %>%
mutate(species = "Cat", weekdays = 0)
fox_P5_activity_weekdays <- activity("Red Fox", P5_weekdays) %>%
mutate(species = "Red Fox", weekdays = 1)
fox_P5_activity_weekends <- activity("Red Fox", P5_weekends) %>%
mutate(species = "Red Fox", weekdays = 0)
marten_P5_activity_weekdays <- activity("Marten", P5_weekdays) %>%
mutate(species = "Marten", weekdays = 1)
marten_P5_activity_weekends <- activity("Marten", P5_weekends) %>%
mutate(species = "Marten", weekdays = 0)
raccoon_P5_activity_weekdays <- activity("Raccoon", P5_weekdays) %>%
mutate(species = "Raccoon", weekdays = 1)
raccoon_P5_activity_weekends <- activity("Raccoon", P5_weekends) %>%
mutate(species = "Raccoon", weekdays = 0)
# Combine all data sets
Activity_squirrel_pred_Berlin_all_seasons <-
rbind(# P1
squirrel_P1_activity_weekdays, squirrel_P1_activity_weekends,
cat_P1_activity_weekdays,cat_P1_activity_weekends,
fox_P1_activity_weekdays,fox_P1_activity_weekends,
marten_P1_activity_weekdays,marten_P1_activity_weekends,
raccoon_P1_activity_weekdays,raccoon_P1_activity_weekends,
# P2
squirrel_P2_activity_weekdays, squirrel_P2_activity_weekends,
cat_P2_activity_weekdays, cat_P2_activity_weekends,
fox_P2_activity_weekdays, fox_P2_activity_weekends,
marten_P2_activity_weekdays, marten_P2_activity_weekends,
raccoon_P2_activity_weekdays, raccoon_P2_activity_weekends,
# P3
squirrel_P3_activity_weekdays, squirrel_P3_activity_weekends,
cat_P3_activity_weekdays, cat_P3_activity_weekends,
fox_P3_activity_weekdays, fox_P3_activity_weekends,
marten_P3_activity_weekdays, marten_P3_activity_weekends,
raccoon_P3_activity_weekdays, raccoon_P3_activity_weekends,
# P4
squirrel_P4_activity_weekdays, squirrel_P4_activity_weekends,
cat_P4_activity_weekdays, cat_P4_activity_weekends,
fox_P4_activity_weekdays, fox_P4_activity_weekends,
marten_P4_activity_weekdays, marten_P4_activity_weekends,
raccoon_P4_activity_weekdays, raccoon_P4_activity_weekends,
# P5
squirrel_P5_activity_weekdays, squirrel_P5_activity_weekends,
cat_P5_activity_weekdays, cat_P5_activity_weekends,
fox_P5_activity_weekdays, fox_P5_activity_weekends,
marten_P5_activity_weekdays, marten_P5_activity_weekends,
raccoon_P5_activity_weekdays, raccoon_P5_activity_weekends)
length(unique(Activity_squirrel_pred_Berlin_all_seasons$User_uid))
#
table(Activity_squirrel_pred_Berlin_all_seasons$species)
#
Activity_squirrel_pred_Berlin_all_seasons %>%
group_by(species) %>%
dplyr::summarise(n_pics = sum(activity))
#
table(Activity_squirrel_pred_Berlin_all_seasons$species, Activity_squirrel_pred_Berlin_all_seasons$project_phase)
ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, mapping = aes(x = species)) +
geom_bar() +
facet_grid(weekdays ~ .)
# 0 = weekend, 1 = week
ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, mapping = aes(x = species)) +
geom_bar() +
facet_grid(garden_type ~ .)
ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, mapping = aes(x = species)) +
geom_bar() +
facet_grid(compost ~ .)
ggplot(data = Activity_squirrel_pred_Berlin_all_seasons,
mapping = aes(x = species, y = Local_tree_cover)) +
geom_boxplot()
ggplot(data = Activity_squirrel_pred_Berlin_all_seasons,
mapping = aes(x = species, y = pop_100)) +
geom_boxplot()
ggplot(data = Activity_squirrel_pred_Berlin_all_seasons,
mapping = aes(x = species, y = imperv_100)) +
geom_boxplot()
squirrels_CT <- CT_act_date_formated[CT_act_date_formated$Species == "Squirrel",]
# add a column for the hour of the day
squirrels_CT$hour <- hour(squirrels_CT$Time)
CT_act_date_formated
saveRDS(object = CT_act_date_formated,
file = here::here("output", "data-proc", "all_seasons",
"CT_act_date_proc_20221117.RDS"))
# stacked_raster_values_and_garden_CT_all_seasons_no_nas
saveRDS(object = stacked_raster_values_and_garden_CT_all_seasons_no_nas,
file = here::here("output", "data-proc", "all_seasons",
"stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20221117.RDS"))
# Activity_squirrel_pred_Berlin_all_seasons
saveRDS(object = Activity_squirrel_pred_Berlin_all_seasons,
file = here::here("output", "data-proc", "all_seasons",
"Activity_squirrel_pred_Berlin_all_seasons_20221117.RDS"))
# squirrels_CT
saveRDS(object = squirrels_CT,
file = here::here("output", "data-proc", "all_seasons",
"squirrels_CT_20221117.RDS"))
#
#
# # Diurnality
# # saveRDS(object = diurnality_predprey_Berlin_all_seasons,
# #         file = here::here("output", "data-proc", "all_seasons",
# #                           "diurnality_predprey_Berlin_all_seasons_20220802.RDS"))
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
##Camera Traps detection histories
#loading the environmental variables and using only the user IDs that are within the cov table
garden_variables <- readRDS(here::here("output", "data-proc", "all_seasons",
"stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20221117.RDS"))
#already formatted and filtered data
CT_act_date_proc <- readRDS(here::here("output", "data-proc", "all_seasons",
"CT_act_date_proc_20221117.RDS"))
View(garden_variables)
devtools::install_github("EcoDynIZW/d6")
library(d6)
library(d6)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")
## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore
## at a later stage
package.list=c(#"camtrapR",
#"dplyr",
#"evaluate",
"ggplot2",
"gdata",
"ggpubr",
"here",
#"janitor",
#"lubridate",
"maptools",
#"ochRe",
# "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
#"plyr",
"raster",
#"readxl",
#"rgdal",
#"rgeos",
#"rjags",
# "rlecuyer",
#"sf",
"showtext",
"skimr",
#"snowfall",
#"sp",
#"stringr",
"tidyverse",
#"vroom"
)
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")
## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore
## at a later stage
package.list=c(#"camtrapR",
#"dplyr",
#"evaluate",
"ggplot2",
"gdata",
"ggpubr",
"here",
#"janitor",
#"lubridate",
"maptools",
#"ochRe",
# "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
#"plyr",
"raster",
#"readxl",
#"rgdal",
#"rgeos",
#"rjags",
# "rlecuyer",
#"sf",
"showtext",
"skimr",
#"snowfall",
#"sp",
#"stringr",
"tidyverse"
#"vroom"
)
for (package in package.list) {
if (!require(package, character.only=T, quietly=T)) {
install.packages(package)
library(package, character.only=T)
}
}
rm(package.list)
rm(package)
##Camera Traps detection histories
#loading the environmental variables and using only the user IDs that are within the cov table
garden_variables <- readRDS(here::here("output", "data-proc", "all_seasons",
"stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20221117.RDS"))
#already formatted and filtered data
CT_act_date_proc <- readRDS(here::here("output", "data-proc", "all_seasons",
"CT_act_date_proc_20221117.RDS"))
View(garden_variables)
View(CT_act_date_proc)
CT_species_interest <- CT_act_date_proc %>%
filter(Species == "Squirrel" |
Species == "Cat" |
Species == "Marten" |
Species == "Raccoon" |
Species == "Red Fox")
CT_per_station <- CT_species_interest %>%
dplyr::count(Species, Station) %>%
group_by(Species) %>%
dplyr::summarize(n_overall = sum(n),
mean_day = mean(n),
median_day = median(n),
min_day = min(n),
max_day = max(n))
CT_per_species
CT_per_station
View(CT_per_station)
View(CT_species_interest)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")
## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore
## at a later stage
package.list=c(#"camtrapR",
#"dplyr",
#"evaluate",
"ggplot2",
"gdata",
"ggpubr",
"here",
#"janitor",
#"lubridate",
"maptools",
#"ochRe",
# "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
#"plyr",
"raster",
#"readxl",
#"rgdal",
#"rgeos",
#"rjags",
# "rlecuyer",
#"sf",
"showtext",
"skimr",
#"snowfall",
#"sp",
#"stringr",
"tidyverse"
#"vroom"
)
for (package in package.list) {
if (!require(package, character.only=T, quietly=T)) {
install.packages(package)
library(package, character.only=T)
}
}
rm(package.list)
rm(package)
##Camera Traps detection histories
#loading the environmental variables and using only the user IDs that are within the cov table
garden_variables <- readRDS(here::here("output", "data-proc", "all_seasons",
"stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20221117.RDS"))
#already formatted and filtered data
CT_act_date_proc <- readRDS(here::here("output", "data-proc", "all_seasons",
"CT_act_date_proc_20221117.RDS"))
CT_species_interest <- CT_act_date_proc %>%
filter(Species == "Squirrel" |
Species == "Cat" |
Species == "Marten" |
Species == "Raccoon" |
Species == "Red Fox")
CT_per_station <- CT_species_interest %>%
dplyr::count(Species, Station) %>%
group_by(Species) %>%
dplyr::summarize(n_overall = sum(n),
mean_day = mean(n),
median_day = median(n),
min_day = min(n),
max_day = max(n))
CT_per_station
View(CT_per_station)
CT_per_station <- CT_species_interest %>%
dplyr::count(Species, Station) #%>%
View(CT_per_station)
table(CT_species_interest$Species, CT_species_interest$Station)
sum(CT_per_station$n)
# Filter for species of interest
CT_species_interest <- CT_act_date_proc %>%
filter(Species == "Squirrel" |
Species == "Cat" |
Species == "Marten" |
Species == "Raccoon" |
Species == "Red Fox")
# Count the number of pictures per species per station
CT_per_station <- CT_species_interest %>%
dplyr::count(Species, Station)
# Overview
head(CT_per_station)
sum(CT_per_station$n) # 55718 = same as number of rows in CT_species_interest
?join
?join
band_members %>% inner_join(band_instruments)
band_members %>% left_join(band_instruments)
band_members %>% right_join(band_instruments)
band_members %>% full_join(band_instruments)
?join
band_members
band_instruments
band_members %>% inner_join(band_instruments)
band_members %>% left_join(band_instruments)
band_members %>% right_join(band_instruments)
band_members %>% full_join(band_instruments)
View(garden_variables)
CT_per_station %>%
left_join(y = garden_variables, by = "Station")
CT_per_station <- CT_per_station %>%
left_join(y = garden_variables, by = "Station")
View(CT_per_station)
View(CT_per_station)
ggplot(data = CT_per_station, mapping = aes(x = fence_height, y = n)) +
geom_point()
View(CT_act_date_proc)
ggplot(data = CT_per_station, mapping = aes(x = fence_height, y = n)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = fence_height)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = fence_height, y = n)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = fence_height)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = pop_100, y = n)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = pop_100)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = fence_height, y = n)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = fence_height)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = garden_type, y = n)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_type)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = pop_100, y = n)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = pop_100)) +
geom_point()
table(CT_per_station$garden_type)
View(garden_variables)
names(CT_per_station)
ggplot(data = CT_per_station, mapping = aes(x = n, y = project_phase)) +
geom_point() +
labs(title = "Number of pictures per project phase")
ggplot(data = CT_per_station, mapping = aes(x = n, y = fence_height)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_type)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_size)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = compost)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = project_phase)) +
geom_point() +
labs(title = "Number of pictures per station per project phase")
ggplot(data = CT_per_station, mapping = aes(x = n, y = fence_height)) +
geom_point()+
labs(title = "Number of pictures per station per fence height")
ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_type)) +
geom_point()+
labs(title = "Number of pictures per station per garden type")
ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_size)) +
geom_point()+
labs(title = "Number of pictures per station per garden size")
ggplot(data = CT_per_station, mapping = aes(x = n, y = compost)) +
geom_point()+
labs(title = "Number of pictures per station per compost")
ggplot(data = CT_per_station, mapping = aes(x = n, y = pop_100)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = dist_water_100)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = imperv_100)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = noise_100)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = Local_tree_cover)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = tree_cover_100)) +
geom_point()
ggplot(data = CT_per_station, mapping = aes(x = n, y = distance_border)) +
geom_point()
=======
TRUE ~ time_diff)) %>%
group_by(project_phase, Station, Date) %>%
filter(time_diff2 > 1) %>%
ungroup()
View(test2)
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = lag(DateTimeOriginal), units = "mins"))%>%
ungroup()
CT_squirrel2 <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel2$Station)
CT_squirrel2$time_diff <- NA
# for (id in species_CT) {
# CT_ID <- CT_Test %>%
#   filter(Species == species_CT[id])
# CT_ID
for (pic in 1:(nrow(CT_squirrel2)-1)) {
# for (i in id_CT) {
if (CT_squirrel2$Station[pic+1] == CT_squirrel2$Station[pic]) {
CT_squirrel2$time_diff[pic+1] <- difftime(time1 = CT_squirrel2$DateTimeOriginal[pic+1], time2 = CT_squirrel2$DateTimeOriginal[pic], units = "mins")
}
}
#}
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = lag(DateTimeOriginal), units = "mins"))%>%
ungroup()
# CT_squirrel <- CT_squirrel %>%
#   mutate(time_diff2 = case_when(
#     is.na(diff_squirrels) ~ 999,
#     TRUE ~ diff_squirrels)) #%>%
#   group_by(project_phase, Station, Date) %>%
#   filter(time_diff2 > 1) %>%
#   ungroup()
# DateTimeOriginal - lag(DateTimeOriginal)
View(CT_squirrel)
View(CT_squirrel2)
?lag
ldeaths
lag(ldeaths, 12)
lag(ldeaths)
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))%>%
ungroup()
# CT_squirrel <- CT_squirrel %>%
#   mutate(time_diff2 = case_when(
#     is.na(diff_squirrels) ~ 999,
#     TRUE ~ diff_squirrels)) #%>%
#   group_by(project_phase, Station, Date) %>%
#   filter(time_diff2 > 1) %>%
#   ungroup()
# DateTimeOriginal - lag(DateTimeOriginal)
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup()
# CT_squirrel <- CT_squirrel %>%
#   mutate(time_diff2 = case_when(
#     is.na(diff_squirrels) ~ 999,
#     TRUE ~ diff_squirrels)) #%>%
#   group_by(project_phase, Station, Date) %>%
#   filter(time_diff2 > 1) %>%
#   ungroup()
# DateTimeOriginal - lag(DateTimeOriginal)
CT_squirrel$diff_squirrels == CT_squirrel2$time_diff
table(CT_squirrel$diff_squirrels == CT_squirrel2$time_diff)
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() %>%
mutate(diff_squirrels2 = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels2 > 1) %>%
ungroup()
# CT_squirrel <- CT_squirrel %>%
#   mutate(time_diff2 = case_when(
#     is.na(diff_squirrels) ~ 999,
#     TRUE ~ diff_squirrels)) #%>%
#   group_by(project_phase, Station, Date) %>%
#   filter(time_diff2 > 1) %>%
#   ungroup()
# DateTimeOriginal - lag(DateTimeOriginal)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() #%>%
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() #%>%
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel3 <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() %>%
mutate(diff_squirrels2 = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels2 > 1) %>%
ungroup()
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() #%>%
View(CT_squirrel3)
table(CT_squirrel$diff_squirrels> 1)
table(CT_squirrel$diff_squirrels < 1)
table(CT_squirrel$diff_squirrels < 1.0)
table(CT_squirrel3$diff_squirrels2 < 1.0)
table(CT_squirrel$diff_squirrels > 1)
1256+1639
table(CT_squirrel$diff_squirrels > 1, useNA = TRUE)
?table
table(CT_squirrel$diff_squirrels > 1, useNA = "always")
1256+1639+228
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() %>%
mutate(diff_squirrels2 = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels2 > 1) %>%
ungroup()
# CT_squirrel <- CT_squirrel %>%
#   mutate(time_diff2 = case_when(
#     is.na(diff_squirrels) ~ 999,
#     TRUE ~ diff_squirrels)) #%>%
#   group_by(project_phase, Station, Date) %>%
#   filter(time_diff2 > 1) %>%
#   ungroup()
# DateTimeOriginal - lag(DateTimeOriginal)
CT_squirrel <- CT_species_interest %>%
filter(Species == "Squirrel")
id_CT <- unique(CT_squirrel$Station)
CT_squirrel <- CT_squirrel %>%
dplyr::group_by(project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
#mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() %>%
mutate(diff_squirrels = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels > 1) %>%
ungroup()
# CT_squirrel <- CT_squirrel %>%
#   mutate(time_diff2 = case_when(
#     is.na(diff_squirrels) ~ 999,
#     TRUE ~ diff_squirrels)) #%>%
#   group_by(project_phase, Station, Date) %>%
#   filter(time_diff2 > 1) %>%
#   ungroup()
# DateTimeOriginal - lag(DateTimeOriginal)
CT_act_time_diff <- CT_act_date_formated %>%
dplyr::group_by(Species, project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() %>%
mutate(diff_squirrels = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels > 1) %>%
ungroup()
View(CT_act_time_diff)
CT_act_time_diff[12]-CT_act_time_diff[11]
CT_act_time_diff$DateTimeOriginal[12]-CT_act_time_diff$DateTimeOriginal[11]
CT_act_time_diff <- CT_act_date_formated %>%
dplyr::group_by(Species, project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
ungroup() %>%
mutate(diff_squirrels = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels > 1) %>%
ungroup()
CT_act_time_diff <- CT_act_date_formated %>%
dplyr::group_by(Species, project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins")) %>%
ungroup() #%>%
CT_act_time_diff <- CT_act_date_formated %>%
dplyr::group_by(Species, project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() %>%
mutate(diff_squirrels = case_when(
is.na(diff_squirrels) ~ 999,
TRUE ~ diff_squirrels)) %>%
group_by(project_phase, Station, Date) %>%
filter(diff_squirrels > 1) %>%
ungroup()
CT_act_time_diff2 <- CT_act_date_formated %>%
dplyr::group_by(Species, project_phase, Station) %>%
dplyr::arrange(DateTimeOriginal) %>%
mutate(diff_squirrels = as.numeric(difftime(time1 = DateTimeOriginal, time2 = dplyr::lag(DateTimeOriginal), units = "mins"))) %>%
ungroup() #%>%
View(CT_act_time_diff2)
View(CT_act_time_diff)
2.529850e+03
### read all environmental raster data ----
imperviousness_2018<-
raster(here("data-raw",
"geo-raw",
"imperviousness_berlin_copernicus_raster_10m_2018_3035",
"imperviousness_berlin_copernicus_raster_10m_2018_3035.tif"
))%>%focal(w=matrix(1,nrow=11,ncol = 11),fun=mean)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
# Chunk 2: packages
library("tidyverse")
library("raster")
library("here")
library("sf")
# Chunk 3: data
### read all environmental raster data ----
imperviousness_2018<-
raster(here("data-raw",
"geo-raw",
"imperviousness_berlin_copernicus_raster_10m_2018_3035",
"imperviousness_berlin_copernicus_raster_10m_2018_3035.tif"
))%>%focal(w=matrix(1,nrow=11,ncol = 11),fun=mean)
crs(imperviousness_2018)<-crs("+init=epsg:3035")
population_density_2019<-
raster(here("data-raw",
"geo-raw",
#"population_density_ha_berlin_10m_2019_3035.tif"
"population-density_berlin_2019_10m_03035_tif",
"population-density_berlin_2019_10m_03035.tif"
))
### read all environmental raster data ----
imperviousness_2018<-
raster(here("data-raw",
"geo-raw",
"imperviousness_berlin_copernicus_raster_10m_2018_3035",
"imperviousness_berlin_copernicus_raster_10m_2018_3035.tif"
))%>%focal(w=matrix(1,nrow=11,ncol = 11),fun=mean)
crs(imperviousness_2018)<-crs("+init=epsg:3035")
plot(imperviousness_2018)
population_density_2019<-
raster(here("data-raw",
"geo-raw",
#"population_density_ha_berlin_10m_2019_3035.tif"
"population-density_berlin_2019_10m_03035_tif",
"population-density_berlin_2019_10m_03035.tif"
))
plot(population_density_2019)
ct_locations<-readRDS(here::here("output",
"data-proc",
"all_seasons",
"stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20230105.RDS"))
ct_spatial<-st_as_sf(ct_locations,coords = c("Long","Lat"),remove=F,crs=32633)%>%
st_transform(crs = 3035)
cov_imperviousness_2018<-raster::extract(x=imperviousness_2018,y=ct_spatial)%>%
data.frame()
colnames(cov_imperviousness_2018)<-"imperviousness_2018"
cov_population_density_2019<-terra::extract(x=population_density_2019,y=ct_spatial)%>%
data.frame()
colnames(cov_population_density_2019)<-"population_density_2019"
berlin <- st_read(here("data-raw",
"geo-raw",
"berlin_city_border_25833.gpkg"), crs = 25833)%>%
st_union() %>%
st_transform(crs = 3035) %>%
st_cast(to = 'LINESTRING')
plot(berlin)
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) %>%
st_union() %>%
#st_transform(crs = 3035) %>%
st_cast(to = 'LINESTRING')
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) %>%
st_union() #%>%
plot(berlin_districts)
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) #%>%
plot(berlin_districts)
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) %>%
st_union() #%>%
plot(berlin_districts)
plot(berlin)
berlin
berlin_districts
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) %>%
st_union() %>%
#st_transform(crs = 3035) %>%
st_cast(to = 'LINESTRING')
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) %>%
st_union() %>%
#st_transform(crs = 3035) %>%
st_cast(to = 'MULTILINESTRING') %>%
st_cast(to = 'LINESTRING')
plot(berlin)
plot(berlin_districts)
?st_union
berlin_districts <- st_read(here("data-raw",
"geo-raw",
"districs_berlin_2022_poly_03035_gpkg",
"districs_berlin_2022_poly_03035.gpkg"), crs = 3035) %>%
st_union(by_feature = FALSE) %>%
#st_transform(crs = 3035) %>%
st_cast(to = 'MULTILINESTRING') %>%
st_cast(to = 'LINESTRING')
plot(berlin_districts)
plot(berlin)
dist_border <- st_distance(ct_spatial, berlin)
colnames(dist_border)<-"distance_to_border"
# bind data
ct_cov <- cbind(ct_spatial,
cov_imperviousness_2018,
cov_population_density_2019,
dist_border)#%>%
View(ct_cov)
# bind data
ct_cov <- cbind(ct_spatial,
cov_imperviousness_2018,
cov_population_density_2019,
dist_border)%>%
dplyr::select(-c(10,12,13,15:18)) # only to compare them
3.045676e+01
ggplot(data = ct_cov, mapping = aes(x = Station, y = imperv_100)) +
geom_point() +
labs(title = "Imperviousness")
ggplot(data = ct_cov, mapping = aes(x = Station, y = imperviousness_2018)) +
geom_point() +
labs(title = "Imperviousness by Marius")
ggplot(data = ct_cov, mapping = aes(x = imperv_100, y = imperviousness_2018)) +
geom_point() +
labs(title = "comparison of imperviousness values")
ggplot(data = ct_cov, mapping = aes(x = Station, y = imperv_100)) +
geom_point() +
labs(title = "Imperviousness")
ggplot(data = ct_cov, mapping = aes(x = Station, y = imperviousness_2018)) +
geom_point() +
labs(title = "Imperviousness by Marius")
ggplot(data = ct_cov, mapping = aes(x = imperv_100, y = imperviousness_2018)) +
geom_point() +
labs(title = "comparison of imperviousness values")
ggplot(data = env_var, mapping = aes(x = Station, y = distance_border)) +
geom_point() +
ylim(0, 20000) +
labs(title = "Distance to border")
ggplot(data = ct_cov, mapping = aes(x = Station, y = distance_border)) +
geom_point() +
ylim(0, 20000) +
labs(title = "Distance to border")
ggplot(data = ct_cov, mapping = aes(x = Station, y = distance_to_border)) +
geom_point()+
ylim(0, 20000) +
labs(title = "Distance to border by Marius")
ggplot(data = ct_cov, mapping = aes(x = Station, y = distance_border)) +
geom_point() +
ylim(0, 20000) +
labs(title = "Distance to border")
ggplot(data = ct_cov, mapping = aes(x = Station, y = as.numeric(distance_to_border))) +
geom_point()+
ylim(0, 20000) +
labs(title = "Distance to border by Marius")
ggplot(data = ct_cov, mapping = aes(x = distance_border, y = as.numeric(distance_to_border))) +
geom_point()+
ylim(0, 20000) +
labs(title = "Comparison of disance to border values")
ggplot(data = ct_cov, mapping = aes(x = Station, y = distance_border)) +
geom_point() +
ylim(0, 20000) +
labs(title = "Distance to border")
ggplot(data = ct_cov, mapping = aes(x = Station, y = as.numeric(distance_to_border))) +
geom_point()+
ylim(0, 20000) +
labs(title = "Distance to border by Marius")
ggplot(data = ct_cov, mapping = aes(x = distance_border, y = as.numeric(distance_to_border))) +
geom_point()+
ylim(0, 20000) +
xlim(0, 20000) +
labs(title = "Comparison of disance to border values")
ggplot(data = ct_cov, mapping = aes(x = Station, y = distance_border)) +
geom_point() +
ylim(0, 20000) +
labs(title = "Distance to border")
ggplot(data = ct_cov, mapping = aes(x = Station, y = as.numeric(distance_to_border))) +
geom_point()+
ylim(0, 20000) +
labs(title = "Distance to border by Marius")
ggplot(data = ct_cov, mapping = aes(x = distance_border, y = as.numeric(distance_to_border))) +
geom_point()+
ylim(0, 15000) +
xlim(0, 15000) +
labs(title = "Comparison of disance to border values")
8.018626e+01
ggplot(data = ct_cov, mapping = aes(x = Station, y = pop_100)) +
geom_point() +
ylim(0, 700) +
labs(title = "Population density")
ggplot(data = ct_cov, mapping = aes(x = Station, y = population_density_2019)) +
geom_point() +
ylim(0, 700) +
labs(title = "Population density by Marius")
ggplot(data = ct_cov, mapping = aes(x = pop_100, y = population_density_2019)) +
geom_point() +
ylim(0, 700) +
labs(title = "Comparison of population density values")
ggplot(data = ct_cov, mapping = aes(x = Station, y = pop_100)) +
geom_point() +
ylim(0, 700) +
xlim(0, 700) +
labs(title = "Population density")
ggplot(data = ct_cov, mapping = aes(x = Station, y = population_density_2019)) +
geom_point() +
ylim(0, 700) +
labs(title = "Population density by Marius")
ggplot(data = ct_cov, mapping = aes(x = pop_100, y = population_density_2019)) +
geom_point() +
ylim(0, 700) +
labs(title = "Comparison of population density values")
ggplot(data = ct_cov, mapping = aes(x = Station, y = pop_100)) +
geom_point() +
ylim(0, 700) +
xlim(0, 700) +
labs(title = "Population density")
ggplot(data = ct_cov, mapping = aes(x = Station, y = population_density_2019)) +
geom_point() +
ylim(0, 700) +
xlim(0, 700) +
labs(title = "Population density by Marius")
ggplot(data = ct_cov, mapping = aes(x = pop_100, y = population_density_2019)) +
geom_point() +
ylim(0, 700) +
xlim(0, 700) +
labs(title = "Comparison of population density values")
table(ct_cov$pop_100, useNA = "always")
table(ct_cov$population_density_2019, useNA = "always")
table(ct_cov$pop_100 == NA, useNA = "always")
table(ct_cov$population_density_2019, useNA = "always")
table(ct_cov$pop_100 == NA, useNA = "always")
table(is.na(ct_cov$pop_100), useNA = "always")
table(is.nan(ct_cov$pop_100), useNA = "always")
is.nan(ct_cov$pop_100)
table(is.na(ct_cov$population_density_2019), useNA = "always")
table(is.na(ct_cov$pop_100), useNA = "always")
table(is.na(ct_cov$population_density_2019), useNA = "always")
table(is.na(ct_cov$pop_100), useNA = "always")
table(is.na(ct_cov$population_density_2019), useNA = "always")
>>>>>>> Stashed changes
