---
title: "Squirrel activity: Data Preparation" ## name of your project and analysis step
description: |
    The aim of this study is...
author:
    ## author information; single arguemnts can be deleted if not needed
    - name: "Sinah Drenske"
      url: https://izw-berlin.de/en/john-smith-en.html  
      affiliation: Leibniz Institute for Zoo and Wildlife Research, Technical University Berlin
      affiliation_url: https://izw-berlin.de/en/
      orcid_id: 0000-0000-0000-0000
    - name: "Julie"
      url: https://janedoe.com
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
      orcid_id: 0000-0000-0000-0000
    - name: "Stephanie Kramer-Schadt"
      url: https://janedoe.com
      affiliation: Leibniz Institute for Zoo and Wildlife Research, Technical University Berlin
      affiliation_url: https://izw-berlin.de/en/
      orcid_id: 0000-0000-0000-0000
    ## add more authors with the same intendation and styling if needed 
    ## a new author always starts with a hyphen!
date: "`r Sys.Date()`"
output: 
    distill::distill_article:
        highlight: kate      ## styling of code
        code_folding: true  ## if `true` you can expand and shrink code chunks
        toc: true            ## if `true` adds a table of content
        toc_depth: 2         ## level to be displayed in the table of content
---

* **Research question:**
* **Study area:**
* **Data:** Already filtered data used by Julie .... in "...."


# Setup
## Packages
```{r packages, message=FALSE, warning=FALSE}
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")

## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore 
## at a later stage
package.list=c("camtrapR",
               "dplyr",
               "evaluate",
               "ggplot2",
               "gdata",
               "here",
               "janitor",
               "lubridate",
               "maptools",
               # "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
               "plyr",
               "raster",
               "readxl",
               #"rgdal",
               #"rgeos",
               #"rjags",
               "rlecuyer",
               #"sf",
               "showtext",
               "skimr",
               "snowfall",
               #"sp",
               "stringr",
               "tidyverse",
               "vroom"
               )

for (package in package.list) {
  if (!require(package, character.only=T, quietly=T)) {
    install.packages(package)
    library(package, character.only=T)
  }
}

```

## Data
```{r data}
##Camera Traps detection histories
#loading the environmental variables and using only the user IDs that are within the cov table
stacked_raster_values_and_garden_CT_all_seasons_no_nas <- readRDS(here::here("data-raw", "r-raw", "stacked_raster_values_and_garden_CT_all_seasons_allcovs_Renamed2022_01_19.RDS"))

#already formatted and filtered data with a delta of 30 mins
CT_act_date_formated <- readRDS(here::here("data-raw", "r-raw","CT_act_allspecies_NoDelta_filtered2022_01_19.RDS"))
```

### Format environmental data
Some columns exist twice - once in German and once in English. We delete the German ones
```{r}
# column 3-7 will be removed
stacked_raster_values_and_garden_CT_all_seasons_no_nas <- stacked_raster_values_and_garden_CT_all_seasons_no_nas[, -(3:7)]
stacked_raster_values_and_garden_CT_all_seasons_no_nas <- droplevels(stacked_raster_values_and_garden_CT_all_seasons_no_nas)
```

# Data overview
## Camera trap detection histories
Season 1: Fall 2018 
Season 2: Spring 2019
Season 3: Fall 2019
Season 4: Spring 2020
Season 5: Fall 2020

```{r}
skim(CT_act_date_formated)
```

### Number of pictures per season
```{r}
table(CT_act_date_formated$Season) 

ggplot(data = CT_act_date_formated, mapping = aes(x = Season)) + 
  geom_bar()
```
### Number of pictures per species (for all seasons)
```{r}
table(CT_act_date_formated$Species) 

ggplot(data = CT_act_date_formated, mapping = aes(x = Species)) + 
  geom_bar()
```
### Number of pictures per species per season
```{r}
table(CT_act_date_formated$Species, CT_act_date_formated$Season) 

ggplot(data = CT_act_date_formated, mapping = aes(x = Species)) + 
  geom_bar() + 
  facet_grid(Season ~ .)
```

## Environmental variables
```{r}
skim(stacked_raster_values_and_garden_CT_all_seasons_no_nas)
```


```{r}
print("Cams per Season")
table(stacked_raster_values_and_garden_CT_all_seasons_no_nas$project_phase)
print("Garden types")
table(stacked_raster_values_and_garden_CT_all_seasons_no_nas$garden_type)
print("Compost types")
table(stacked_raster_values_and_garden_CT_all_seasons_no_nas$compost)
print("Compost types & garden types")
table(stacked_raster_values_and_garden_CT_all_seasons_no_nas$compost, stacked_raster_values_and_garden_CT_all_seasons_no_nas$garden_type)
```
```{r}
ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = as.factor(project_phase), y = Local_tree_cover)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(y = Local_tree_cover)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = garden_type, y = garden_size)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = as.factor(project_phase), y = pop_100)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = as.factor(project_phase), y = imperv_100)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = as.factor(project_phase), y = noise_100)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = as.factor(project_phase), y = tree_cover_100)) + 
  geom_boxplot()

ggplot(data = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
       mapping = aes(x = as.factor(project_phase), y = distance_border)) + 
  geom_boxplot()
```

# Dataset of the activity per Station per weekend or weekday
We calculated the activity (nr of photos per species) per station and divided if the photos were taken during the week or during the weekend

```{r weekdays weekends}
#code for separating weekdays and weekends
# transform date variables to correct formats
activity_data <- CT_act_date_formated %>% 
  mutate(date_wday = lubridate::wday(CT_act_date_formated$Date, label = TRUE))%>% 
#binary variable for weekdays or weekends
 dplyr::mutate(weekdays_binary = factor(ifelse(date_wday == "Sa"| date_wday == "So", "0", "1")))
##careful here the name of days depend on the language settings of the computer

#let's create a list that would contain the dates of beginning and end for each season
list_date_monthly <- list()
list_date_monthly[[1]] <- c(as.Date("2018-10-07"),
                           as.Date("2018-11-04")) #P1
list_date_monthly[[2]] <- c(as.Date("2019-04-01"),
                           as.Date("2019-04-28")) #P2
list_date_monthly[[3]] <- c(as.Date("2019-09-30"), 
                           as.Date("2019-10-27")) #P3
list_date_monthly[[4]] <- c(as.Date("2020-03-30"),
                           as.Date("2020-04-26")) #P4
list_date_monthly[[5]] <- c(as.Date("2020-09-28"), 
                           as.Date("2020-10-26")) #P5

#filter by date
P1 <- activity_data %>% filter(Date >= list_date_monthly[[1]][1] & Date <= list_date_monthly[[1]][2])
P2 <- activity_data %>% filter(Date >= list_date_monthly[[2]][1] & Date <= list_date_monthly[[2]][2])
P3 <- activity_data %>% filter(Date >= list_date_monthly[[3]][1] & Date <= list_date_monthly[[3]][2])
P4 <- activity_data %>% filter(Date >= list_date_monthly[[4]][1] & Date <= list_date_monthly[[4]][2])
P5 <- activity_data %>% filter(Date >= list_date_monthly[[5]][1] & Date <= list_date_monthly[[5]][2])

#separating for weekends and weekdays
P1_weekdays <- P1 %>% dplyr::filter(weekdays_binary == 1)
P1_weekends <- P1 %>% dplyr::filter(weekdays_binary == 0)

P2_weekdays <- P2 %>% dplyr::filter(weekdays_binary == 1)
P2_weekends <- P2 %>% dplyr::filter(weekdays_binary == 0)

P3_weekdays <- P3 %>% dplyr::filter(weekdays_binary == 1)
P3_weekends <- P3 %>% dplyr::filter(weekdays_binary == 0)

P4_weekdays <- P4 %>% dplyr::filter(weekdays_binary == 1)
P4_weekends <- P4 %>% dplyr::filter(weekdays_binary == 0)

P5_weekdays <- P5 %>% dplyr::filter(weekdays_binary == 1)
P5_weekends <- P5 %>% dplyr::filter(weekdays_binary == 0)
```

```{r activity function}
#function for counting the number of pictures for each species
activity <- function(species, CT)
{
  CT_species <- CT %>% filter(Species == species)

  Unique_CT <- unique(CT_species$Station)
  l <- list(0)

  for(i in Unique_CT)
    {
      l[[which(Unique_CT == i)]] <- 
      nrow(CT_species %>% filter(Station == i)) 
     #% of pictures taken during the night
      names(l)[which(Unique_CT == i)] <- as.character(i)
       }
   x <- data.frame(unlist(l))
   x <- dplyr::rename(x, activity = unlist.l.)
   x <- x %>% mutate(User_uid = as.numeric(rownames(x)))
   x_covenv <- dplyr::inner_join(x = x,
                                 y = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
                                 by = c("User_uid" = "Station")) 
                #merging with the covenv
   return(x_covenv)

}
```

## Create a table per species per phase/season per weekdays/weekend
```{r table per species per season per weekends/weekdays}
## P1
squirrel_P1_activity_weekdays <- activity("Eichhörnchen", P1_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P1_activity_weekends <- activity("Eichhörnchen", P1_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P1_activity_weekdays <- activity("cat", P1_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P1_activity_weekends <- activity("cat", P1_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P1_activity_weekdays <- activity("Rotfuchs", P1_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P1_activity_weekends <- activity("Rotfuchs", P1_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P1_activity_weekdays <- activity("Marder_(Baum-und_Steinmarder)", P1_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P1_activity_weekends <- activity("Marder_(Baum-und_Steinmarder)", P1_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P1_activity_weekdays <- activity("Waschbär", P1_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P1_activity_weekends <- activity("Waschbär", P1_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

## P2
squirrel_P2_activity_weekdays <- activity("Eichhörnchen", P2_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P2_activity_weekends <- activity("Eichhörnchen", P2_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P2_activity_weekdays <- activity("cat", P2_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P2_activity_weekends <- activity("cat", P2_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P2_activity_weekdays <- activity("Rotfuchs", P2_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P2_activity_weekends <- activity("Rotfuchs", P2_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P2_activity_weekdays <- activity("Marder_(Baum-und_Steinmarder)", P2_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P2_activity_weekends <- activity("Marder_(Baum-und_Steinmarder)", P2_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P2_activity_weekdays <- activity("Waschbär", P2_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P2_activity_weekends <- activity("Waschbär", P2_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

## P3
squirrel_P3_activity_weekdays <- activity("Eichhörnchen", P3_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P3_activity_weekends <- activity("Eichhörnchen", P3_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P3_activity_weekdays <- activity("cat", P3_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P3_activity_weekends <- activity("cat", P3_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P3_activity_weekdays <- activity("Rotfuchs", P3_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P3_activity_weekends <- activity("Rotfuchs", P3_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P3_activity_weekdays <- activity("Marder_(Baum-und_Steinmarder)", P3_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P3_activity_weekends <- activity("Marder_(Baum-und_Steinmarder)", P3_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P3_activity_weekdays <- activity("Waschbär", P3_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P3_activity_weekends <- activity("Waschbär", P3_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

#P4
squirrel_P4_activity_weekdays <- activity("Eichhörnchen", P4_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P4_activity_weekends <- activity("Eichhörnchen", P4_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P4_activity_weekdays <- activity("cat", P4_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P4_activity_weekends <- activity("cat", P4_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P4_activity_weekdays <- activity("Rotfuchs", P4_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P4_activity_weekends <- activity("Rotfuchs", P4_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P4_activity_weekdays <- activity("Marder_(Baum-und_Steinmarder)", P4_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P4_activity_weekends <- activity("Marder_(Baum-und_Steinmarder)", P4_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P4_activity_weekdays <- activity("Waschbär", P4_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P4_activity_weekends <- activity("Waschbär", P4_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

#P5
squirrel_P5_activity_weekdays <- activity("Eichhörnchen", P5_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P5_activity_weekends <- activity("Eichhörnchen", P5_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P5_activity_weekdays <- activity("cat", P5_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P5_activity_weekends <- activity("cat", P5_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P5_activity_weekdays <- activity("Rotfuchs", P5_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P5_activity_weekends <- activity("Rotfuchs", P5_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P5_activity_weekdays <- activity("Marder_(Baum-und_Steinmarder)", P5_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P5_activity_weekends <- activity("Marder_(Baum-und_Steinmarder)", P5_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P5_activity_weekdays <- activity("Waschbär", P5_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P5_activity_weekends <- activity("Waschbär", P5_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

# Combine all data sets
Activity_predprey_Berlin_all_seasons <- 
  rbind(# P1
    squirrel_P1_activity_weekdays, squirrel_P1_activity_weekends, 
    cat_P1_activity_weekdays,cat_P1_activity_weekends,
    fox_P1_activity_weekdays,fox_P1_activity_weekends,
    marten_P1_activity_weekdays,marten_P1_activity_weekends,
    raccoon_P1_activity_weekdays,raccoon_P1_activity_weekends,
    # P2
    squirrel_P2_activity_weekdays, squirrel_P2_activity_weekends, 
    cat_P2_activity_weekdays, cat_P2_activity_weekends, 
    fox_P2_activity_weekdays, fox_P2_activity_weekends, 
    marten_P2_activity_weekdays, marten_P2_activity_weekends,
    raccoon_P2_activity_weekdays, raccoon_P2_activity_weekends,
    # P3
    squirrel_P3_activity_weekdays, squirrel_P3_activity_weekends,
    cat_P3_activity_weekdays, cat_P3_activity_weekends,
    fox_P3_activity_weekdays, fox_P3_activity_weekends, 
    marten_P3_activity_weekdays, marten_P3_activity_weekends,
    raccoon_P3_activity_weekdays, raccoon_P3_activity_weekends,
    # P4
    squirrel_P4_activity_weekdays, squirrel_P4_activity_weekends,
    cat_P4_activity_weekdays, cat_P4_activity_weekends,
    fox_P4_activity_weekdays, fox_P4_activity_weekends,
    marten_P4_activity_weekdays, marten_P4_activity_weekends,
    raccoon_P4_activity_weekdays, raccoon_P4_activity_weekends,
    # P5
    squirrel_P5_activity_weekdays, squirrel_P5_activity_weekends,
    cat_P5_activity_weekdays, cat_P5_activity_weekends,
    fox_P5_activity_weekdays, fox_P5_activity_weekends,
    marten_P5_activity_weekdays, marten_P5_activity_weekends, 
    raccoon_P5_activity_weekdays, raccoon_P5_activity_weekends)

length(unique(Activity_predprey_Berlin_all_seasons$User_uid))
```

## Save data
```{r}
# #Save data
# saveRDS(object = Activity_predprey_Berlin_all_seasons,
#         file = here::here("output", "data-proc", "all_seasons",
#                           "Activity_predprey_Berlin_all_seasons_20220802.RDS"))
```

## Overview
```{r}
# 
table(Activity_predprey_Berlin_all_seasons$species)

# 
Activity_predprey_Berlin_all_seasons %>% 
  group_by(species) %>%
  dplyr::summarise(n_pics = sum(activity))

# 
table(Activity_predprey_Berlin_all_seasons$species, Activity_predprey_Berlin_all_seasons$project_phase) 

ggplot(data = Activity_predprey_Berlin_all_seasons, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(weekdays ~ .)
# 0 = weekend, 1 = week

ggplot(data = Activity_predprey_Berlin_all_seasons, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(garden_type ~ .)

ggplot(data = Activity_predprey_Berlin_all_seasons, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(compost ~ .)

ggplot(data = Activity_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = Local_tree_cover)) + 
  geom_boxplot()

ggplot(data = Activity_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = pop_100)) + 
  geom_boxplot()

ggplot(data = Activity_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = imperv_100)) + 
  geom_boxplot()
```


# Squirrels only
We build a data set only for the squirrels.
```{r squirrel data set}
squirrels_CT <- CT_act_date_formated[CT_act_date_formated$Species == "Eichhörnchen",]
# add a column for the hour of the day
squirrels_CT$hour <- hour(squirrels_CT$Time)
```

Squirrels are not active during the night. But when are they active?
```{r squirrel time}
# find the min and max hours of the day where the squirrels were active
range(squirrels_CT$hour)
# when are squirrels active during the day?
ggplot(data = squirrels_CT, mapping = aes(x = hour)) + 
  geom_bar()
```
# Diurnality
Squirrels where active between 5am and 7pm. So we will filter our data for the time between 5am-7pm for the whole month divided by weekdays and weekends
```{r diurnality function}
#function for counting the number of pictures for each species
diurnality <- function(species, CT) # one has to insert the species and the data set for the filtering
{
  CT_species <- CT %>% filter(Species == species) # 

  Unique_CT <- unique(CT_species$Station)
  l <- list(0)
  k <- list(0)

  for(i in Unique_CT)
    { #% of pictures taken during the day
      l[[which(Unique_CT == i)]] <- 
      (nrow(CT_species %>% filter(Station == i) %>% dplyr::filter(Time >= hms("05:00:00") 
                                & Time <= hms("19:00:00"))))/nrow(CT_species %>%
                           filter(Station == i)) 
      names(l)[which(Unique_CT == i)] <- as.character(i)
      
      #number of pictures taken during the day
      k[[which(Unique_CT == i)]] <- 
      (nrow(CT_species %>% filter(Station == i) %>% dplyr::filter(Time >= hms("05:00:00") 
                                & Time <= hms("19:00:00")))) 
      names(k)[which(Unique_CT == i)] <- as.character(i)

       }
   x <- data.frame(unlist(l))
   x <- dplyr::rename(x, diurnality = unlist.l.)
   x <- x %>% mutate(User_uid = as.numeric(rownames(x)))
   x_covenv <- dplyr::inner_join(x = x,
                                 y = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
                                 by = c("User_uid" = "Station")) #merging with the covenv

   y <- data.frame(unlist(k))
   y <- dplyr::rename(y, nbr_pictures_day = unlist.k.)
   y <- y %>% mutate(User_uid = as.numeric(rownames(y)))
   y_covenv <- dplyr::inner_join(x = y,
                                 y = x_covenv) #merging with the covenv
   return(y_covenv)
   
}
```


## Create a table per species per season per weekdays/weekend
```{r diurnality table}
#P1
squirrel_P1_diurnality_weekdays <- diurnality("Eichhörnchen", P1_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P1_diurnality_weekends <- diurnality("Eichhörnchen", P1_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P1_diurnality_weekdays <- diurnality("cat", P1_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P1_diurnality_weekends <- diurnality("cat", P1_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P1_diurnality_weekdays <- diurnality("Rotfuchs", P1_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P1_diurnality_weekends <- diurnality("Rotfuchs", P1_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P1_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P1_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P1_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P1_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P1_diurnality_weekdays <- diurnality("Waschbär", P1_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P1_diurnality_weekends <- diurnality("Waschbär", P1_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

#P2
squirrel_P2_diurnality_weekdays <- diurnality("Eichhörnchen", P2_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P2_diurnality_weekends <- diurnality("Eichhörnchen", P2_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P2_diurnality_weekdays <- diurnality("cat", P2_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P2_diurnality_weekends <- diurnality("cat", P2_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P2_diurnality_weekdays <- diurnality("Rotfuchs", P2_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P2_diurnality_weekends <- diurnality("Rotfuchs", P2_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P2_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P2_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P2_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P2_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P2_diurnality_weekdays <- diurnality("Waschbär", P2_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P2_diurnality_weekends <- diurnality("Waschbär", P2_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

#P3
squirrel_P3_diurnality_weekdays <- diurnality("Eichhörnchen", P3_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P3_diurnality_weekends <- diurnality("Eichhörnchen", P3_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P3_diurnality_weekdays <- diurnality("cat", P3_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P3_diurnality_weekends <- diurnality("cat", P3_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P3_diurnality_weekdays <- diurnality("Rotfuchs", P3_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P3_diurnality_weekends <- diurnality("Rotfuchs", P3_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P3_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P3_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P3_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P3_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P3_diurnality_weekdays <- diurnality("Waschbär", P3_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P3_diurnality_weekends <- diurnality("Waschbär", P3_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

#P4
squirrel_P4_diurnality_weekdays <- diurnality("Eichhörnchen", P4_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P4_diurnality_weekends <- diurnality("Eichhörnchen", P4_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P4_diurnality_weekdays <- diurnality("cat", P4_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P4_diurnality_weekends <- diurnality("cat", P4_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P4_diurnality_weekdays <- diurnality("Rotfuchs", P4_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P4_diurnality_weekends <- diurnality("Rotfuchs", P4_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P4_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P4_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P4_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P4_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P4_diurnality_weekdays <- diurnality("Waschbär", P4_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P4_diurnality_weekends <- diurnality("Waschbär", P4_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

#P5
squirrel_P5_diurnality_weekdays <- diurnality("Eichhörnchen", P5_weekdays) %>%
  mutate(species = "Squirrel", weekdays = 1)
squirrel_P5_diurnality_weekends <- diurnality("Eichhörnchen", P5_weekends) %>%
  mutate(species = "Squirrel", weekdays = 0)

cat_P5_diurnality_weekdays <- diurnality("cat", P5_weekdays) %>%
  mutate(species = "Cat", weekdays = 1)
cat_P5_diurnality_weekends <- diurnality("cat", P5_weekends) %>%
  mutate(species = "Cat", weekdays = 0)

fox_P5_diurnality_weekdays <- diurnality("Rotfuchs", P5_weekdays) %>%
  mutate(species = "Fox", weekdays = 1)
fox_P5_diurnality_weekends <- diurnality("Rotfuchs", P5_weekends) %>%
  mutate(species = "Fox", weekdays = 0)

marten_P5_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P5_weekdays) %>%
  mutate(species = "Marten", weekdays = 1)
marten_P5_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P5_weekends) %>%
  mutate(species = "Marten", weekdays = 0)

raccoon_P5_diurnality_weekdays <- diurnality("Waschbär", P5_weekdays) %>%
  mutate(species = "Raccoon", weekdays = 1)
raccoon_P5_diurnality_weekends <- diurnality("Waschbär", P5_weekends) %>%
  mutate(species = "Raccoon", weekdays = 0)

# Combine the data sets
diurnality_predprey_Berlin_all_seasons <- 
  rbind( # P1
    squirrel_P1_diurnality_weekdays, squirrel_P1_diurnality_weekends,
    cat_P1_diurnality_weekdays, cat_P1_diurnality_weekends,
    fox_P1_diurnality_weekdays, fox_P1_diurnality_weekends, 
    marten_P1_diurnality_weekdays, marten_P1_diurnality_weekends,
    raccoon_P1_diurnality_weekdays, raccoon_P1_diurnality_weekends,
    # P2
    squirrel_P2_diurnality_weekdays, squirrel_P2_diurnality_weekends,
    cat_P2_diurnality_weekdays, cat_P2_diurnality_weekends,
    fox_P2_diurnality_weekdays, fox_P2_diurnality_weekends,
    marten_P2_diurnality_weekdays, marten_P2_diurnality_weekends, 
    raccoon_P2_diurnality_weekdays, raccoon_P2_diurnality_weekends,
    # P3
    squirrel_P3_diurnality_weekdays, squirrel_P3_diurnality_weekends,
    cat_P3_diurnality_weekdays, cat_P3_diurnality_weekends,
    fox_P3_diurnality_weekdays, fox_P3_diurnality_weekends, 
    marten_P3_diurnality_weekdays, marten_P3_diurnality_weekends,
    raccoon_P3_diurnality_weekdays, raccoon_P3_diurnality_weekends,
    # P4
    squirrel_P4_diurnality_weekdays, squirrel_P4_diurnality_weekends,
    cat_P4_diurnality_weekdays, cat_P4_diurnality_weekends,
    fox_P4_diurnality_weekdays, fox_P4_diurnality_weekends, 
    marten_P4_diurnality_weekdays, marten_P4_diurnality_weekends,
    raccoon_P4_diurnality_weekdays, raccoon_P4_diurnality_weekends,
    # P5
    squirrel_P5_diurnality_weekdays, squirrel_P5_diurnality_weekends,
    cat_P5_diurnality_weekdays, cat_P5_diurnality_weekends,
    fox_P5_diurnality_weekdays, fox_P5_diurnality_weekends,
    marten_P5_diurnality_weekdays, marten_P5_diurnality_weekends, 
    raccoon_P5_diurnality_weekdays, raccoon_P5_diurnality_weekends)

length(unique(diurnality_predprey_Berlin_all_seasons$User_uid))
```
Hint: it is fine that the number of rows in the datasets for activity and diurnality are the same. But the number of pictures per day per station is different

## Save data
```{r}
#Save data
# saveRDS(object = diurnality_predprey_Berlin_all_seasons,
#         file = here::here("output", "data-proc", "all_seasons",
#                           "diurnality_predprey_Berlin_all_seasons_20220802.RDS"))
```

## Overview - ORDNEN!!!!
Und schauen was man überhaupt nehmen kann und wie man das am besten vergleicht
### All data
```{r}
## All data 
range(diurnality_predprey_Berlin_all_seasons$diurnality)
summary(diurnality_predprey_Berlin_all_seasons$diurnality)
ggplot(data = diurnality_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = diurnality)) + 
  geom_boxplot()
```

```{r}
# 
table(diurnality_predprey_Berlin_all_seasons$species)
table(Activity_predprey_Berlin_all_seasons$species)

# 
diurnality_predprey_Berlin_all_seasons %>% 
  group_by(species) %>%
  dplyr::summarise(n_pics = sum(nbr_pictures_day), mean_diurnality = mean(diurnality))

# 
table(diurnality_predprey_Berlin_all_seasons$species, diurnality_predprey_Berlin_all_seasons$project_phase) 

ggplot(data = diurnality_predprey_Berlin_all_seasons, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(weekdays ~ .)
# 0 = weekend, 1 = week

ggplot(data = diurnality_predprey_Berlin_all_seasons, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(garden_type ~ .)

ggplot(data = diurnality_predprey_Berlin_all_seasons, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(compost ~ .)

ggplot(data = diurnality_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = Local_tree_cover)) + 
  geom_boxplot()

ggplot(data = diurnality_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = pop_100)) + 
  geom_boxplot()

ggplot(data = diurnality_predprey_Berlin_all_seasons, 
       mapping = aes(x = species, y = imperv_100)) + 
  geom_boxplot()
```

### Without days and species where diurnality = 0
```{r}
# Remove rows where diurnality = 0
table(diurnality_predprey_Berlin_all_seasons$diurnality>0)
diurnality_predprey_Berlin_all_seasons_not0 <- diurnality_predprey_Berlin_all_seasons[diurnality_predprey_Berlin_all_seasons$diurnality != 0, ]
```



```{r}
summary(diurnality_predprey_Berlin_all_seasons_not0$diurnality)
table(diurnality_predprey_Berlin_all_seasons$species)
table(Activity_predprey_Berlin_all_seasons$species)

# 
table(diurnality_predprey_Berlin_all_seasons_not0$species)
table(Activity_predprey_Berlin_all_seasons$species)

# 
diurnality_predprey_Berlin_all_seasons_not0 %>% 
  group_by(species) %>%
  dplyr::summarise(n_pics = sum(nbr_pictures_day), mean_diurnality = mean(diurnality))

# 
table(diurnality_predprey_Berlin_all_seasons_not0$species, diurnality_predprey_Berlin_all_seasons_not0$project_phase) 

ggplot(data = diurnality_predprey_Berlin_all_seasons_not0, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(weekdays ~ .)
# 0 = weekend, 1 = week

ggplot(data = diurnality_predprey_Berlin_all_seasons_not0, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(garden_type ~ .)

ggplot(data = diurnality_predprey_Berlin_all_seasons_not0, mapping = aes(x = species)) + 
  geom_bar() + 
  facet_grid(compost ~ .)

ggplot(data = diurnality_predprey_Berlin_all_seasons_not0, 
       mapping = aes(x = species, y = Local_tree_cover)) + 
  geom_boxplot()

ggplot(data = diurnality_predprey_Berlin_all_seasons_not0, 
       mapping = aes(x = species, y = pop_100)) + 
  geom_boxplot()

ggplot(data = diurnality_predprey_Berlin_all_seasons_not0, 
       mapping = aes(x = species, y = imperv_100)) + 
  geom_boxplot()
```

***

<details><summary>Session Info</summary>

```{r sessionInfo}
## DO NOT REMOVE!
## We store the settings of your computer and the current versions of the
## packages used to allow for reproducibility
Sys.time()
#git2r::repository() ## uncomment if you are using GitHub
sessionInfo()
```

</details>
