---
title: "Squirrel activity: General description" ## name of your project and analysis step
description: |
    The aim of this study is...
author:
    ## author information; single arguemnts can be deleted if not needed
    - name: "John Smith"
      url: https://izw-berlin.de/en/john-smith-en.html  
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
      orcid_id: 0000-0000-0000-0000
    - name: "Jane Doe"
      url: https://janedoe.com
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
    ## add more authors with the same intendation and styling if needed 
    ## a new author always starts with a hyphen!
date: "`r Sys.Date()`"
output: 
    distill::distill_article:
        highlight: kate      ## styling of code
        code_folding: false  ## if `true` you can expand and shrink code chunks
        toc: true            ## if `true` adds a table of content
        toc_depth: 2         ## level to be displayed in the table of content
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, 
                      dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
```

* **Research question:**
* **Study area:**
* **Data:** 


# Setup
## Packages
```{r packages, message=FALSE, warning=FALSE}
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")

## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore 
## at a later stage

#devtools::install_github("ropenscilabs/ochRe")

package.list=c("camtrapR",
               "dplyr",
               "evaluate",
               "ggplot2",
               "gdata",
               "ggpubr",
               "here",
               "janitor",
               "lubridate",
               "maptools",
               "ochRe",
               # "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
               "plyr",
               "raster",
               "readxl",
               #"rgdal",
               #"rgeos",
               #"rjags",
               "rlecuyer",
               #"sf",
               "showtext",
               "skimr",
               "snowfall",
               #"sp",
               "stringr",
               "tidyverse",
               "vroom"
               )

for (package in package.list) {
  if (!require(package, character.only=T, quietly=T)) {
    install.packages(package)
    library(package, character.only=T)
  }
}

rm(package.list)
rm(package)
```

## Data
```{r data}
##Camera Traps detection histories
#loading the environmental variables and using only the user IDs that are within the cov table
garden_variables <- readRDS(here::here("output", "data-proc", "all_seasons",
                                       "stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20221117.RDS"))

#already formatted and filtered data 
CT_act_date_proc <- readRDS(here::here("output", "data-proc", "all_seasons",
                                       "CT_act_date_proc_20221117.RDS"))
```


# Summaries
## all species
### Number of pictures per season
```{r}
CT_act_date_proc %>% 
  dplyr::count(Season)

CT_act_date_proc %>% 
  dplyr::count(Season) %>%  
  summarise(mean_season = mean(n))

length(unique(CT_act_date_proc$Species))
```

## Species of interest
```{r}
CT_species_interest <- CT_act_date_proc %>%
  filter(Species == "Squirrel" | 
           Species == "Cat" | 
           Species == "Marten" | 
           Species == "Raccoon" | 
           Species == "Red Fox")
```


### Number of pictures per species (for all seasons)
```{r}
# Pictures per Species over all seasons, mean number of pics per day, median per day
CT_per_species <- CT_species_interest %>% 
  dplyr::count(Species, Date) %>%
  group_by(Species) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_day = mean(n), 
                   median_day = median(n), 
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species
# CT_per_species <- CT_species_interest %>% 
#   dplyr::count(Species, Date)

# CT_per_species_season_day <- CT_species_interest %>% 
#   dplyr::count(Species, Season, Date)

CT_per_species_season <- CT_species_interest %>% 
  dplyr::count(Species, Season, Date) %>%
  group_by(Species, Season) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_day = mean(n), 
                   median_day = median(n), 
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species_season

##################### BOXPLOT
############## SAME for filtered data (30 min) like Julie
#### Squirrels in SPring: maybbe problems with confidence intervals


```


```{r}
ggdotchart(data = CT_per_species, x = "Species", y = "n_overall", 
           sorting = "descending", 
           ylab = "Nr pictures",
           shape = 19, 
           dot.size = 5,
           add = "segments", 
           add.params = list(color = "darkgray", size = 2), 
           color = "Species",
           #palette = "magma",
           rotate = FALSE, 
           show.legend = FALSE, 
           ggtheme = theme_pubr()) + 
  theme(legend.position = "none", 
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", size = 1)) + 
  labs_pubr() + 
  scale_colour_ochre(palette="emu_woman_paired")  

# ggsave(filename = here::here("plots", "pics_per_species.png"))
```


### Number of pictures per species per season
```{r}
# Pictures per species per season
CT_act_date_proc %>% 
  dplyr::count(Species, Season) 

table(CT_act_date_proc$Species, CT_act_date_proc$Season) 

ggplot(data = CT_act_date_proc, mapping = aes(x = Species)) + 
  geom_bar() + 
  facet_grid(Season ~ .)
```

## Squirrels
### Number of squirrels per season 
```{r}
squirrels_season <- CT_act_date_proc %>%
  filter(Species == "Squirrel") %>%
  dplyr::count(Season)
squirrels_season

# sum photos of squirrels during all seasons
sum(squirrels_season$n)
# mean number of photos during all seasons
mean(squirrels_season$n)
# mean number of photos during autumn
mean(squirrels_season$n[c(1,3,5)])
# mean number of photos during spring
mean(squirrels_season$n[c(2,4)])
```



### Activity plots
#### overall
```{r}
# All data
activityRadial(recordTable = CT_act_date_proc, 
               species = "Squirrel", 
               lwd = 3)
# activityRadial(recordTable = CT_act_date_proc, 
#                species = "Squirrel", 
#                lwd = 3, 
#                line.col = "black", rad.col = "grey", 
#                grid.col = "grey", 
#                grid.bg = "white")

activityRadial(recordTable = CT_act_date_proc, species = "Squirrel", lwd = 3, rp.type = "p", poly.col = gray(0.5, alpha = 0.5))


```

#### per season
```{r}
CT_data_per_season <- split(x = CT_act_date_proc, f = CT_act_date_proc$Season)
CT_data_season1 <- as.data.frame(CT_data_per_season[[1]])
CT_data_season2 <- as.data.frame(CT_data_per_season[[2]])
CT_data_season3 <- as.data.frame(CT_data_per_season[[3]])
CT_data_season4 <- as.data.frame(CT_data_per_season[[4]])
CT_data_season5 <- as.data.frame(CT_data_per_season[[5]])
```

```{r}
activityRadial(recordTable = CT_data_season1, 
               species = "Squirrel", 
               rp.type = "p", 
               lwd = 3)
# activityRadial(recordTable = CT_data_per_season[[1]], 
#                species = "Squirrel", 
#                lwd = 3)
activityRadial(recordTable = CT_data_season2, species = "Squirrel", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season3, species = "Squirrel", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season4, species = "Squirrel", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season5, species = "Squirrel", rp.type = "p", lwd = 3)

################## Same scale for all seasons
################## overlap plots
```

```{r}
activityDensity(recordTable = CT_data_season1, species = "Squirrel")
activityDensity(recordTable = CT_data_season2, species = "Squirrel")
activityDensity(recordTable = CT_data_season3, species = "Squirrel")
activityDensity(recordTable = CT_data_season4, species = "Squirrel")
activityDensity(recordTable = CT_data_season5, species = "Squirrel")
```


```{r}
activityRadial(recordTable = CT_act_date_proc, 
               species = "Squirrel", 
               lwd = 3)
# activityRadial(recordTable = CT_act_date_proc, 
#                species = "Squirrel", 
#                lwd = 3, 
#                line.col = "black", rad.col = "grey", 
#                grid.col = "grey", 
#                grid.bg = "white")
```

## Cats
### Number of cats per season 
```{r}
cats_season <- CT_act_date_proc %>%
  filter(Species == "Cat") %>%
  dplyr::count(Season)
cats_season

# sum photos of cats during all seasons
sum(cats_season$n)
# mean number of photos during all seasons
mean(cats_season$n)
# mean number of photos during autumn
mean(cats_season$n[c(1,3,5)])
# mean number of photos during spring
mean(cats_season$n[c(2,4)])
```

### Activity plots
#### overall
```{r}
# All data
activityRadial(recordTable = CT_act_date_proc, 
               species = "Cat", 
               lwd = 3)

activityRadial(recordTable = CT_act_date_proc, species = "Cat", lwd = 3, rp.type = "p", poly.col = gray(0.5, alpha = 0.5))
```

#### per season
```{r}
activityRadial(recordTable = CT_data_season1, 
               species = "Cat", 
               rp.type = "p", 
               lwd = 3)
activityRadial(recordTable = CT_data_season2, species = "Cat", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season3, species = "Cat", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season4, species = "Cat", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season5, species = "Cat", rp.type = "p", lwd = 3)
```

## Martens
### Number of martens per season 
```{r}
martens_season <- CT_act_date_proc %>%
  filter(Species == "Marten") %>%
  dplyr::count(Season)
martens_season

# sum photos of martens during all seasons
sum(martens_season$n)
# mean number of photos during all seasons
mean(martens_season$n)
# mean number of photos during autumn
mean(martens_season$n[c(1,3,5)])
# mean number of photos during spring
mean(martens_season$n[c(2,4)])
```

### Activity plots
#### overall
```{r}
# All data
activityRadial(recordTable = CT_act_date_proc, 
               species = "Marten", 
               lwd = 3)

activityRadial(recordTable = CT_act_date_proc, species = "Marten", lwd = 3, rp.type = "p", poly.col = gray(0.5, alpha = 0.5))
```

#### per season
```{r}
activityRadial(recordTable = CT_data_season1, 
               species = "Marten", 
               rp.type = "p", 
               lwd = 3)
activityRadial(recordTable = CT_data_season2, species = "Marten", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season3, species = "Marten", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season4, species = "Marten", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season5, species = "Marten", rp.type = "p", lwd = 3)
```


## Red foxes
### Number of red foxes per season 
```{r}
fox_season <- CT_act_date_proc %>%
  filter(Species == "Red Fox") %>%
  dplyr::count(Season)
fox_season

# sum photos of red foxes during all seasons
sum(fox_season$n)
# mean number of photos during all seasons
mean(fox_season$n)
# mean number of photos during autumn
mean(fox_season$n[c(1,3,5)])
# mean number of photos during spring
mean(fox_season$n[c(2,4)])
```

### Activity plots
#### overall
```{r}
# All data
activityRadial(recordTable = CT_act_date_proc, 
               species = "Red Fox", 
               lwd = 3)

activityRadial(recordTable = CT_act_date_proc, species = "Red Fox", lwd = 3, rp.type = "p", poly.col = gray(0.5, alpha = 0.5))
```

#### per season
```{r}
activityRadial(recordTable = CT_data_season1, 
               species = "Red Fox", 
               rp.type = "p", 
               lwd = 3)
activityRadial(recordTable = CT_data_season2, species = "Red Fox", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season3, species = "Red Fox", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season4, species = "Red Fox", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season5, species = "Red Fox", rp.type = "p", lwd = 3)
```


## Raccoons
### Number of raccoons per season 
```{r}
raccoons_season <- CT_act_date_proc %>%
  filter(Species == "Raccoon") %>%
  dplyr::count(Season)
raccoons_season

# sum photos of raccoons during all seasons
sum(raccoons_season$n)
# mean number of photos during all seasons
mean(raccoons_season$n)
# mean number of photos during autumn
mean(raccoons_season$n[c(1,3,5)])
# mean number of photos during spring
mean(raccoons_season$n[c(2,4)])
```

### Activity plots
#### overall
```{r}
# All data
activityRadial(recordTable = CT_act_date_proc, 
               species = "Raccoon", 
               lwd = 3)

activityRadial(recordTable = CT_act_date_proc, species = "Raccoon", lwd = 3, rp.type = "p", poly.col = gray(0.5, alpha = 0.5))
```

#### per season
```{r}
activityRadial(recordTable = CT_data_season1, 
               species = "Raccoon", 
               rp.type = "p", 
               lwd = 3)
activityRadial(recordTable = CT_data_season2, species = "Raccoon", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season3, species = "Raccoon", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season4, species = "Raccoon", rp.type = "p", lwd = 3)
activityRadial(recordTable = CT_data_season5, species = "Raccoon", rp.type = "p", lwd = 3)
```








***

<details><summary>Session Info</summary>

```{r sessionInfo}
## DO NOT REMOVE!
## We store the settings of your computer and the current versions of the
## packages used to allow for reproducibility
Sys.time()
#git2r::repository() ## uncomment if you are using GitHub
sessionInfo()
```

</details>
