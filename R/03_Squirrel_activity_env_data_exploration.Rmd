---
title: "Squirrel activity: Exploration of the environmental data" ## name of your project and analysis step
description: |
    The aim of this study is...
author:
    ## author information; single arguemnts can be deleted if not needed
    - name: "John Smith"
      url: https://izw-berlin.de/en/john-smith-en.html  
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
      orcid_id: 0000-0000-0000-0000
    - name: "Jane Doe"
      url: https://janedoe.com
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
    ## add more authors with the same intendation and styling if needed 
    ## a new author always starts with a hyphen!
date: "`r Sys.Date()`"
output: 
    distill::distill_article:
        highlight: kate      ## styling of code
        code_folding: false  ## if `true` you can expand and shrink code chunks
        toc: true            ## if `true` adds a table of content
        toc_depth: 2         ## level to be displayed in the table of content
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, 
                      dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
```

* **Research question:**
* **Study area:**
* **Data:** 


# Setup

```{r packages}
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")

## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore 
## at a later stage
package.list=c(#"camtrapR",
               #"dplyr",
               #"evaluate",
               "ggplot2",
               "gdata",
               "ggpubr",
               "here",
               #"janitor",
               #"lubridate",
               "maptools",
               #"ochRe",
               # "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
               #"plyr",
               "raster",
               #"readxl",
               #"rgdal",
               #"rgeos",
               #"rjags",
              # "rlecuyer",
               #"sf",
               "showtext",
               "skimr",
               #"snowfall",
               #"sp",
               #"stringr",
               "tidyverse"
               #"vroom"
               )

for (package in package.list) {
  if (!require(package, character.only=T, quietly=T)) {
    install.packages(package)
    library(package, character.only=T)
  }
}

rm(package.list)
rm(package)
```


# Data

```{r data}
##Camera Traps detection histories
#loading the environmental variables and using only the user IDs that are within the cov table
garden_variables <- readRDS(here::here("output", "data-proc", "all_seasons",
                                       "stacked_raster_values_and_garden_CT_all_seasons_no_nas_proc_20221117.RDS"))

#already formatted and filtered data 
CT_act_date_proc <- readRDS(here::here("output", "data-proc", "all_seasons",
                                       "CT_act_date_proc_20221117.RDS"))
```

# Map of the camera stations
We create a map to plot the locations of the camera stations

# Raster data exploration


# Relationship between the number of photos per station and environmental variables
We create a table of the number of squirrel pictures per station and of the predator pictures per station
```{r}
# Filter for species of interest
CT_species_interest <- CT_act_date_proc %>%
  filter(Species == "Squirrel" | 
           Species == "Cat" | 
           Species == "Marten" | 
           Species == "Raccoon" | 
           Species == "Red Fox")

# Count the number of pictures per species per station
CT_per_station <- CT_species_interest %>% 
  dplyr::count(Species, Station) 

# Overview
head(CT_per_station)
sum(CT_per_station$n) # 55718 = same as number of rows in CT_species_interest
```

Then we combine this table with the table of the environmental covariates
```{r}
CT_per_station <- CT_per_station %>%
  left_join(y = garden_variables, by = "Station")

# data for 3 stations is missing: 1091, 1394, 1816
```

Then we make some plots to explore the relationship between the number of pictures and the environmental covariates
```{r}
ggplot(data = CT_per_station, mapping = aes(x = n, y = project_phase)) + 
  geom_point() + 
  labs(title = "Number of pictures per station per project phase", 
       x = "Number of pictures per station", 
       y = "Project phase")

ggplot(data = CT_per_station, mapping = aes(x = n, y = fence_height)) + 
  geom_point()+ 
  labs(title = "Number of pictures per station per fence height")

ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_type)) + 
  geom_point()+ 
  labs(title = "Number of pictures per station per garden type")

ggplot(data = CT_per_station, mapping = aes(x = n, y = garden_size)) + 
  geom_point()+ 
  labs(title = "Number of pictures per station per garden size")


ggplot(data = CT_per_station, mapping = aes(x = n, y = compost)) + 
  geom_point()+ 
  labs(title = "Number of pictures per station per compost")
```


```{r}
ggplot(data = CT_per_station, mapping = aes(x = n, y = pop_100)) + 
  geom_point()

ggplot(data = CT_per_station, mapping = aes(x = n, y = dist_water_100)) + 
  geom_point()

ggplot(data = CT_per_station, mapping = aes(x = n, y = imperv_100)) + 
  geom_point()

ggplot(data = CT_per_station, mapping = aes(x = n, y = noise_100)) + 
  geom_point()

ggplot(data = CT_per_station, mapping = aes(x = n, y = Local_tree_cover)) + 
  geom_point()

ggplot(data = CT_per_station, mapping = aes(x = n, y = tree_cover_100)) + 
  geom_point()

ggplot(data = CT_per_station, mapping = aes(x = n, y = distance_border)) + 
  geom_point()
```


***

<details><summary>Session Info</summary>

```{r sessionInfo}
## DO NOT REMOVE!
## We store the settings of your computer and the current versions of the
## packages used to allow for reproducibility
Sys.time()
#git2r::repository() ## uncomment if you are using GitHub
sessionInfo()
```

</details>
