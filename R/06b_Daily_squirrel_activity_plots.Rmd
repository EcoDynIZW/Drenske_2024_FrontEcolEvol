---
title: "Squirrel activity: Daily patterns activity plots" ## name of your project and analysis step
description: |
    The aim of this study is...
author:
    ## author information; single arguemnts can be deleted if not needed
    - name: "John Smith"
      url: https://izw-berlin.de/en/john-smith-en.html  
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
      orcid_id: 0000-0000-0000-0000
    - name: "Jane Doe"
      url: https://janedoe.com
      affiliation: Leibniz Institute for Zoo and Wildlife Research
      affiliation_url: https://izw-berlin.de/en/
    ## add more authors with the same intendation and styling if needed 
    ## a new author always starts with a hyphen!
date: "`r Sys.Date()`"
output: 
    distill::distill_article:
        highlight: kate      ## styling of code
        code_folding: false  ## if `true` you can expand and shrink code chunks
        toc: true            ## if `true` adds a table of content
        toc_depth: 2         ## level to be displayed in the table of content
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, 
                      dev = "ragg_png", fig.width = 9, fig.height = 6, dpi = 600, retina = 1)
Sys.setlocale("LC_TIME", "C")
```

* **Research question:**
* **Study area:**
* **Data:** 

# Setup
```{r packages, message=FALSE, warning=FALSE}
# install the package librarian, it loads and installs (if necessary) the specified packages from CRAN, GitHub or Bioconductor

#devtools::install_github("DesiQuintans/librarian")
librarian::shelf(update_all = FALSE,
                 camtrapR,
                 extrafont,
                 #dplyr,
                 #evaluate, 
                 gdata, 
                 #ggplot2, 
                 ggpubr, 
                 here, 
                 #janitor, 
                 lubridate,
                 overlap, 
                 #maptools, 
                 #ropenscilabs / ochRe,
                 #"optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
                 #plyr,
                 #raster,
                 #readxl, 
                 #rgdal, 
                 #rgeos, 
                 #rjags, 
                 #rlecuyer, 
                 thomasp85 / scico, 
                 #sf, 
                 showtext, 
                 skimr, 
                 #snowfall, 
                 #sp, 
                 stringr, 
                 tidyverse, 
                 #vroom
                 )
```

# Data
```{r}
# CT_species_interest
CT_species_interest <- readRDS(here::here("output",
                                          "data-proc",
                                          "all_seasons",
                                          "CT_species_interest_radians_20230223.RDS"))
# CT_species_interest_hour_station
CT_species_interest_hour_station <- readRDS(here::here("output",
                                                       "data-proc",
                                                       "all_seasons",
                                                       "CT_species_interest_hour_station_20230223.RDS"))
```

Build a class for the imperviousness
```{r}
CT_species_interest <- CT_species_interest %>%
  mutate(class = as.factor(case_when(imperviousness_2018 < 20 ~ 1, 
                                     imperviousness_2018 < 40 ~ 2, 
                                     imperviousness_2018 < 60 ~ 3, 
                                     imperviousness_2018 < 80 ~ 4, 
                                     imperviousness_2018 < 101 ~ 5)))
```


## Palettes
```{r palette}
# darkdarkblue beige greyblue red brown 
pal_5 <- c("#303B4A", "#E4CAA5", "#4D6476", "#C83649", "#837461") # 
pal_3 <- c("#E4CAA5", "#4D6476", "#837461")
pal_2 <- c("#E4CAA5", "#4D6476")
```




# Summary tables
The first table is a summary of all pictures that were taken of the species and the mean, median, min and max per day
The second table shows the number of pictures per species per season (spring vs autumn) with the number of pictures per season and mean, median, min and max per day

```{r}
# Pictures per Species over all seasons, mean number of pics per day, median per day
CT_per_species_day <- CT_species_interest %>% 
  dplyr::count(Species, Date) %>%
  group_by(Species) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_day = mean(n), 
                   median_day = median(n), 
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species_day

CT_per_species <- CT_species_interest %>% 
  dplyr::count(Species, project_phase, Station) %>%
  group_by(Species, project_phase) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   n_stations = n())

CT_per_species


# Pictures per species per project phase
CT_per_species_season <- CT_species_interest %>% 
  dplyr::count(Species, project_phase, Date) %>%
  group_by(Species, project_phase) %>% 
  dplyr::summarize(n_overall = sum(n),
                   n_days = n(),
                   mean_day = mean(n), 
                   median_day = median(n), 
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species_season
```

Here is a plot that shows the number of pictures per species for all seasons
```{r}
ggdotchart(data = CT_per_species, x = "Species", y = "n_overall", 
           sorting = "descending", 
           ylab = "Number of pictures",
           shape = 19,
           size = 5,
           dot.size = 6,
           add = "segments", 
           add.params = list(color = "darkgray", size = 2), 
           color = "Species",
           #palette = "magma",
           #position = position_dodge(width = 0.2, preserve = "single"), 
           rotate = FALSE, 
           show.legend = FALSE, 
           ggtheme = theme_pubr(x.text.angle = 90)) + 
  scale_y_continuous(
    limits = c(0, 19000),
    breaks = seq(0, 18000, by = 2000),
    expand = c(.001, .001)) + 
  scale_x_discrete(expand = c(0.08, 0.001)) + 
  scale_colour_manual(values = pal_5) +
  theme(legend.position = "none", 
        panel.background = element_rect(fill = "white"), #e9e5db
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2),
        axis.text.x = element_text(angle = 0, vjust = 1, hjust = 0.5), 
        axis.ticks.length = unit(0.1, "cm")) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11)

# ggsave(filename = here::here("plots","02_general_patterns", "pics_per_species.png"),
#        width = 1200*1.25,
#        height = 1200,
#        units = "px",
#        dpi = 300)

```


And this table shows the number of pictures per species per project phase
```{r}
table(CT_species_interest$Species, CT_species_interest$project_phase)
```

Number of pictures per species per project phase
```{r}
ggplot(data = CT_species_interest, mapping = aes(x = Species)) + 
  geom_bar() + 
  facet_grid(project_phase ~ .)
```

Number of pictures per species per project phase
```{r}
CT_per_species_phase <- CT_species_interest %>% 
  dplyr::count(Species, project_phase, Date) %>%
  group_by(Species, project_phase) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_day = mean(n), 
                   median_day = median(n), 
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species_phase
```

Plot of the number of pictures per species per day per project phase
```{r}
CT_species_interest %>% 
  dplyr::count(Species, project_phase, Date) %>%
  group_by(Species, project_phase) %>%
  ggplot(mapping = aes(x = as.factor(project_phase), y = n)) + 
  geom_boxplot() + 
  facet_wrap(~Species)
```

Plot of the number of pictures per species per day per season
```{r}
CT_species_interest %>% 
  dplyr::count(Species, Season, Date) %>%
  group_by(Species, Season) %>%
  ggplot(mapping = aes(x = as.factor(Season), y = n)) + 
  geom_boxplot() + 
  facet_wrap(~Species)
```

## Squirrel summaries 
```{r}
squirrels_phase <- CT_species_interest %>%
  filter(Species == "Squirrel") %>%
  dplyr::count(project_phase)
squirrels_phase

# sum photos of squirrels during all seasons
sum(squirrels_phase$n)
# mean number of photos during all seasons
mean(squirrels_phase$n)
# mean number of photos during autumn
mean(squirrels_phase$n[c(2,4)])
# mean number of photos during spring
mean(squirrels_phase$n[c(1,3)])
```


# Activity plots
## overall
```{r}
CT_species_interest_hour_station %>%
  filter(Species == "Squirrel") %>%
  group_by(Species, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  ungroup() %>%
  add_row(Species = "Squirrel", hour_day = c(0:4, 19:23), n_hour = 0) %>%
  ggplot() + 
  geom_col(mapping = aes(hour_day, n_hour, fill = n_hour), colour = "white", width = 1) + 
  coord_polar(start = 25, direction = 1) + 
  scale_fill_scico(palette = "lajolla") + # bilbao, lajolla, vikO, turku, 
  theme_light() + 
  ylab("number of pictures\n") + 
  labs(title = paste0("Daily activity of Squirrels"), 
       fill = "pictures \nper hour") + 
  theme(title = element_text(size = 16, face = "bold"),
        axis.title = element_text(size = 14), 
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour = "grey20", size = 12), 
        axis.text.y = element_text(colour = "grey20", size = 12),
        legend.title = element_text(size = 12, face = "bold"),
        legend.text = element_text(size = 12),
        panel.border = element_blank(),
        panel.grid = element_line(colour = "#8c8c8b"),#8c8c8b, #b3b2b1
        panel.background = element_rect(fill = "white"), # "#ded9ca"
        plot.background = element_rect(fill = "white"), # "#ded9ca"
        legend.background = element_rect(colour = "white", fill = "white"))
```

```{r}
# Sum
CT_species_interest_hour_station %>%
  filter(Species == "Squirrel") %>%
  group_by(Species, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  ungroup() %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0))  %>%
  ggplot() + 
  geom_line(mapping = aes(x = hour_day, y = n_hour), colour = "#C83649", size = 2) + #"#AC4645" "#5D3125" "#191900"
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 200),
    breaks = seq(0, 200, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill = NA, size = 2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11)

# Sum
CT_squirrel_predators_hour %>%
  group_by(Species, hour_day) %>%
  dplyr::summarize(n_hour = sum(squirrel_sum_hour), sd_hour = sd(squirrel_sum_hour)) %>%
  ungroup() %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0, sd_hour = 0))  %>%
  ggplot() + 
  geom_line(mapping = aes(x = hour_day, y = n_hour), colour = "#C83649", size = 2) + #"#AC4645" "#5D3125" "#191900"
  #geom_line(mapping = aes(x = hour_day, y = (n_hour - sd_hour)), colour = "green", size = 1) + 
  #geom_line(mapping = aes(x = hour_day, y = (n_hour + sd_hour)), colour = "blue", size = 1) + 
  geom_ribbon(aes(x = hour_day, y = n_hour, ymin = n_hour - sd_hour, ymax = n_hour + sd_hour, fill = "black")) +
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 200),
    breaks = seq(0, 200, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill = NA, size = 2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11)

# ggsave(filename = here::here("plots","03_daily_patterns", "squirrels_overall.png"),
#        width = 1200*1.25,
#        height = 1200,
#        units = "px",
#        dpi = 300)
```



## Project phase
```{r}
CT_species_interest_hour_station %>%
  filter(Species == "Squirrel") %>%
  group_by(project_phase, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = project_phase, fill = project_phase)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 300),
    breaks = seq(0, 300, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_5) 
```

Overlap estimate
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Species == "Squirrel", ], 
                speciesA = "2", 
                speciesB = "3", 
                speciesCol = "project_phase", 
                overlapEstimator = "Dhat4")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$project_phase == "2", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$project_phase == "3", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel") %>%
  group_by(project_phase) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```


## Season
### Overall
```{r}
CT_species_interest_hour_station %>%
  filter(Species == "Squirrel") %>%
  group_by(Season, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = Season, fill = Season)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 250),
    breaks = seq(0, 250, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2) 

# ggsave(filename = here::here("plots","03_daily_patterns", "squirrels_season.png"),
#        width = 1200*1.25,
#        height = 1200,
#        units = "px",
#        dpi = 300)
```

Overlap estimate
```{r}
test <- activityOverlap(recordTable = CT_species_interest[CT_species_interest$Species == "Squirrel", ], 
                        speciesA = "autumn", 
                        speciesB = "spring", 
                        speciesCol = "Season", 
                        overlapEstimator = "Dhat4")
```
### ggplot solution
```{r}
ggplot(data = test) + 
  geom_line(mapping = aes(x = x, y = densityA)) + 
  geom_line(mapping = aes(x = x, y = densityB)) + 
  geom_area(mapping = aes(x = x, y = pmin(densityA,densityB)), fill = "red")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & 
                                     CT_species_interest$Season == "autumn", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Squirrel" & 
                                     CT_species_interest$Season == "spring", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel") %>%
  group_by(Season) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

DELET### Season and other variables
Build a dataset for the different seasons
```{r}
Squirrels_spring <- CT_species_interest %>%
  filter(Species == "Squirrel" & Season == "spring") %>%
  droplevels()

Squirrels_autumn <- CT_species_interest %>%
  filter(Species == "Squirrel" & Season == "autumn") %>%
  droplevels()

Squirrels_spring_hour <- CT_species_interest_hour_station %>%
  filter(Species == "Squirrel" & Season == "spring") %>%
  droplevels()

Squirrels_autumn_hour <- CT_species_interest_hour_station %>%
  filter(Species == "Squirrel" & Season == "autumn") %>%
  droplevels()
```

#### Season and dogs binary
```{r}
Squirrels_spring_hour %>%
  #filter(Species == "Squirrel") %>%
  group_by(dogs_binary, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = dogs_binary, fill = dogs_binary)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 250),
    breaks = seq(0, 250, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2) 

Squirrels_autumn_hour %>%
  #filter(Species == "Squirrel") %>%
  group_by(dogs_binary, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = dogs_binary, fill = dogs_binary)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 250),
    breaks = seq(0, 250, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2)
```

Overlap estimate
```{r}
activityOverlap(recordTable = Squirrels_spring, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))

activityOverlap(recordTable = Squirrels_autumn, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))

activityOverlap(recordTable = Squirrels_autumn, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4",  
                ylim = c(0,0.2), 
                legend = FALSE, 
                bty = "o", 
                main = " ", 
                linecol = pal_2, 
                linewidth = c(3,3), 
                olapcol = "#E4CAA5", 
                xlab = "Hour of the day") # brown: #837461 darkblue: #303B4A beige #E4CAA5
#box(lwd = 2, which = "plot")
legend("topleft", c("no dog", "dog"), lty=1, col=c("#E4CAA5", "#4D6476"), bg="white")

```


```{r}
activityOverlap
```

```{r}
overlapEst(A = Squirrels_spring[Squirrels_spring$dogs_binary == "0", ]$radtime, 
           B = Squirrels_spring[Squirrels_spring$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn[Squirrels_autumn$dogs_binary == "0", ]$radtime, 
           B = Squirrels_autumn[Squirrels_autumn$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
Squirrels_spring %>%
  group_by(dogs_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_autumn %>%
  group_by(dogs_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```



#### Season and cats binary
```{r}
activityOverlap(recordTable = Squirrels_spring, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "cats_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))

activityOverlap(recordTable = Squirrels_autumn, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "cats_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))
```


```{r}
overlapEst(A = Squirrels_spring[Squirrels_spring$cats_binary == "0", ]$radtime, 
           B = Squirrels_spring[Squirrels_spring$cats_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn[Squirrels_autumn$cats_binary == "0", ]$radtime, 
           B = Squirrels_autumn[Squirrels_autumn$cats_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
Squirrels_spring %>%
  group_by(cats_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_autumn %>%
  group_by(cats_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

#### Season and cats
Overlap estimate
```{r}
# png(file=here::here("plots","03_daily_patterns", "squirrels_cats_overlap_spring.png"),
#     width=600, 
#     height=350)
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Season == "spring", ], 
                speciesA = "Squirrel", 
                speciesB = "Cat", 
                speciesCol = "Species", 
                overlapEstimator = "Dhat4",
                ylim = c(0,0.15), 
                legend = FALSE, 
                bty = "o", 
                linecol = pal_2, 
                linewidth = c(3,3), 
                olapcol = "#E4CAA5", 
                xlab = "Hour of the day")
legend("topleft", c("Squirrel", "Cat"), lty=1, col=c("#E4CAA5", "#4D6476"), bg="white")
#dev.off()

# png(file=here::here("plots","03_daily_patterns", "squirrels_cats_overlap_autumn.png"),
#     width=600, 
#     height=350)
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Season == "autumn", ], 
                speciesA = "Squirrel", 
                speciesB = "Cat", 
                speciesCol = "Species", 
                overlapEstimator = "Dhat4",
                ylim = c(0,0.15), 
                legend = FALSE, 
                bty = "o", 
                linecol = pal_2, 
                linewidth = c(3,3), 
                olapcol = "#E4CAA5", 
                xlab = "Hour of the day")
legend("topleft", c("Squirrel", "Cat"), lty=1, col=c("#E4CAA5", "#4D6476"), bg="white")
#dev.off()
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & 
                                     CT_species_interest$Season == "spring", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Cat" & 
                                     CT_species_interest$Season == "spring", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & 
                                     CT_species_interest$Season == "autumn", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Cat" & 
                                     CT_species_interest$Season == "autumn", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel" | Species == "Cat") %>%
  group_by(Species, Season) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

# Cats cam binary
Squirrels_spring %>%
  group_by(cats_cam_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_autumn %>%
  group_by(cats_cam_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

#### Season and martens
Overlap estimate
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Season == "spring", ], 
                        speciesA = "Squirrel", 
                        speciesB = "Marten", 
                        speciesCol = "Species", 
                        overlapEstimator = "Dhat4")

activityOverlap(recordTable = CT_species_interest[CT_species_interest$Season == "autumn", ], 
                        speciesA = "Squirrel", 
                        speciesB = "Marten", 
                        speciesCol = "Species", 
                        overlapEstimator = "Dhat4")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & 
                                     CT_species_interest$Season == "spring", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Marten" & 
                                     CT_species_interest$Season == "spring", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & 
                                     CT_species_interest$Season == "autumn", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Marten" & 
                                     CT_species_interest$Season == "autumn", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel" | Species == "Marten") %>%
  group_by(Species, Season) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

# Cats cam binary
Squirrels_spring %>%
  group_by(marten_cam_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_autumn %>%
  group_by(marten_cam_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

#### Season and imperviousness
```{r}
activityOverlap(recordTable = Squirrels_spring, 
                speciesA = "1", 
                speciesB = "2", 
                speciesCol = "class", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))

activityOverlap(recordTable = Squirrels_autumn, 
                speciesA = "1", 
                speciesB = "2", 
                speciesCol = "class", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))
```

```{r}
table(Squirrels_spring$class)
table(Squirrels_autumn$class)

```

```{r}
overlapEst(A = Squirrels_spring[Squirrels_spring$class == "1", ]$radtime, 
           B = Squirrels_spring[Squirrels_spring$class == "2", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn[Squirrels_autumn$class == "1", ]$radtime, 
           B = Squirrels_autumn[Squirrels_autumn$class == "2", ]$radtime, 
           kmax = 3, 
           type = "all")
```


```{r}
overlapEst(A = Squirrels_spring[Squirrels_spring$class == "2", ]$radtime, 
           B = Squirrels_spring[Squirrels_spring$class == "3", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn[Squirrels_autumn$class == "2", ]$radtime, 
           B = Squirrels_autumn[Squirrels_autumn$class == "3", ]$radtime, 
           kmax = 3, 
           type = "all")
```

```{r}
overlapEst(A = Squirrels_spring[Squirrels_spring$class == "4", ]$radtime, 
           B = Squirrels_spring[Squirrels_spring$class == "5", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn[Squirrels_autumn$class == "4", ]$radtime, 
           B = Squirrels_autumn[Squirrels_autumn$class == "5", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
Squirrels_spring %>%
  group_by(class) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_autumn %>%
  group_by(class) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

### Season and Lockdown and others
```{r}
Squirrels_spring_lock0 <- Squirrels_spring %>%
  filter(lockdown == "0") %>%
  droplevels()

Squirrels_spring_lock1 <- Squirrels_spring %>%
  filter(lockdown == "1") %>%
  droplevels()


Squirrels_autumn_lock0 <- Squirrels_autumn %>%
  filter(lockdown == "0") %>%
  droplevels()

Squirrels_autumn_lock1 <- Squirrels_autumn %>%
  filter(lockdown == "1") %>%
  droplevels()
```

#### dogs binary
```{r}
activityOverlap(recordTable = Squirrels_spring_lock0, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))

activityOverlap(recordTable = Squirrels_spring_lock1, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))

activityOverlap(recordTable = Squirrels_autumn_lock0, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))

activityOverlap(recordTable = Squirrels_autumn_lock1, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))
```

```{r}
overlapEst(A = Squirrels_spring_lock0[Squirrels_spring_lock0$dogs_binary == "0", ]$radtime, 
           B = Squirrels_spring_lock0[Squirrels_spring_lock0$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_spring_lock1[Squirrels_spring_lock1$dogs_binary == "0", ]$radtime, 
           B = Squirrels_spring_lock1[Squirrels_spring_lock1$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn_lock0[Squirrels_autumn_lock0$dogs_binary == "0", ]$radtime, 
           B = Squirrels_autumn_lock0[Squirrels_autumn_lock0$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_autumn_lock1[Squirrels_autumn_lock1$dogs_binary == "0", ]$radtime, 
           B = Squirrels_autumn_lock1[Squirrels_autumn_lock1$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```
##### dhat per camera
```{r}
overlapEst(A = Squirrels_spring_lock0[Squirrels_spring_lock0$dogs_binary == "0" & Squirrels_spring_lock0$Station == 453, ]$radtime, 
           B = Squirrels_spring_lock0[Squirrels_spring_lock0$dogs_binary == "1" & Squirrels_spring_lock0$Station == 453, ]$radtime, 
           kmax = 3, 
           type = "Dhat4") 
```

per camera
```{r}
# save cameras as vector
cams_Squirrels_spring_lock0 <- unique(Squirrels_spring_lock0$Station)
# for loop for calculation per camera
for (n in 1:length(unique(Squirrels_spring_lock0$Station))) {
overlapEst(A = Squirrels_spring_lock0[Squirrels_spring_lock0$dogs_binary == "0" & Squirrels_spring_lock0$Station == n, ]$radtime, 
           B = Squirrels_spring_lock0[Squirrels_spring_lock0$dogs_binary == "1" & Squirrels_spring_lock0$Station == n, ]$radtime, 
           kmax = 3, 
           type = "Dhat4") 
}
```


## Lockdown
```{r}
CT_species_interest_hour_station %>%
  filter(Species == "Squirrel") %>%
  group_by(lockdown, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = lockdown, fill = lockdown)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 300),
    breaks = seq(0, 300, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2) 
```

Overlap estimate
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Species == "Squirrel", ], 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "lockdown", 
                overlapEstimator = "Dhat4")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$lockdown == "0", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$lockdown == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel") %>%
  group_by(lockdown) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

### Lockdown and other variables
Build a dataset for the different seasons
```{r}
Squirrels_lock0 <- CT_species_interest %>%
  filter(Species == "Squirrel" & lockdown == "0") %>%
  droplevels()

Squirrels_lock1 <- CT_species_interest %>%
  filter(Species == "Squirrel" & lockdown == "1") %>%
  droplevels()

Squirrels_lock0_hour <- CT_species_interest_hour_station %>%
  filter(Species == "Squirrel" & lockdown == "0") %>%
  droplevels()

Squirrels_lock1_hour <- CT_species_interest_hour_station %>%
  filter(Species == "Squirrel" & lockdown == "1") %>%
  droplevels()
```

#### Lockdown and dogs binary
```{r}
Squirrels_lock0_hour %>%
  #filter(Species == "Squirrel") %>%
  group_by(dogs_binary, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = dogs_binary, fill = dogs_binary)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 250),
    breaks = seq(0, 250, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2) 

Squirrels_lock1_hour %>%
  #filter(Species == "Squirrel") %>%
  group_by(dogs_binary, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = dogs_binary, fill = dogs_binary)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 250),
    breaks = seq(0, 250, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2)
```

Overlap estimate
```{r}
activityOverlap(recordTable = Squirrels_lock0, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))

activityOverlap(recordTable = Squirrels_lock1, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.2))
```


```{r}
overlapEst(A = Squirrels_lock0[Squirrels_lock0$dogs_binary == "0", ]$radtime, 
           B = Squirrels_lock0[Squirrels_lock0$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_lock1[Squirrels_lock1$dogs_binary == "0", ]$radtime, 
           B = Squirrels_lock1[Squirrels_lock1$dogs_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
Squirrels_lock0 %>%
  group_by(dogs_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_lock1 %>%
  group_by(dogs_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```



#### Lockdown and cats binary
```{r}
activityOverlap(recordTable = Squirrels_lock0, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "cats_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))

activityOverlap(recordTable = Squirrels_lock1, 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "cats_binary", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))
```


```{r}
overlapEst(A = Squirrels_lock0[Squirrels_lock0$cats_binary == "0", ]$radtime, 
           B = Squirrels_lock0[Squirrels_lock0$cats_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_lock1[Squirrels_lock1$cats_binary == "0", ]$radtime, 
           B = Squirrels_lock1[Squirrels_lock1$cats_binary == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
Squirrels_lock0 %>%
  group_by(cats_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_lock1 %>%
  group_by(cats_binary) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

#### Lockdown and cats
Overlap estimate
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$lockdown == "0", ], 
                        speciesA = "Squirrel", 
                        speciesB = "Cat", 
                        speciesCol = "Species", 
                        overlapEstimator = "Dhat4")

activityOverlap(recordTable = CT_species_interest[CT_species_interest$lockdown == "1", ], 
                        speciesA = "Squirrel", 
                        speciesB = "Cat", 
                        speciesCol = "Species", 
                        overlapEstimator = "Dhat4")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$lockdown == "0", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Cat" & CT_species_interest$lockdown == "0", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$lockdown == "1", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Cat" & CT_species_interest$lockdown == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel" | Species == "Cat") %>%
  group_by(Species, lockdown) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

#### Lockdown and martens
Overlap estimate
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$lockdown == "0", ], 
                        speciesA = "Squirrel", 
                        speciesB = "Marten", 
                        speciesCol = "Species", 
                        overlapEstimator = "Dhat4")

activityOverlap(recordTable = CT_species_interest[CT_species_interest$lockdown == "1", ], 
                        speciesA = "Squirrel", 
                        speciesB = "Marten", 
                        speciesCol = "Species", 
                        overlapEstimator = "Dhat4")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$lockdown == "0", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Marten" & CT_species_interest$lockdown == "0", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$lockdown == "1", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Marten" & CT_species_interest$lockdown == "1", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel" | Species == "Marten") %>%
  group_by(Species, lockdown) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```

#### Lockdown and imperviousness
```{r}
table(Squirrels_lock0$class)
table(Squirrels_lock1$class)
```


```{r}
activityOverlap(recordTable = Squirrels_lock0, 
                speciesA = "1", 
                speciesB = "2", 
                speciesCol = "class", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))

activityOverlap(recordTable = Squirrels_lock1, 
                speciesA = "1", 
                speciesB = "2", 
                speciesCol = "class", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))

activityOverlap(recordTable = Squirrels_lock0, 
                speciesA = "2", 
                speciesB = "3", 
                speciesCol = "class", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))

activityOverlap(recordTable = Squirrels_lock1, 
                speciesA = "2", 
                speciesB = "3", 
                speciesCol = "class", 
                overlapEstimator = "Dhat4", 
                ylim = c(0,0.25))
```



```{r}
overlapEst(A = Squirrels_lock0[Squirrels_lock0$class == "1", ]$radtime, 
           B = Squirrels_lock0[Squirrels_lock0$class == "2", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_lock1[Squirrels_lock1$class == "1", ]$radtime, 
           B = Squirrels_lock1[Squirrels_lock1$class == "2", ]$radtime, 
           kmax = 3, 
           type = "all")
```


```{r}
overlapEst(A = Squirrels_lock0[Squirrels_lock0$class == "2", ]$radtime, 
           B = Squirrels_lock0[Squirrels_lock0$class == "3", ]$radtime, 
           kmax = 3, 
           type = "all")

overlapEst(A = Squirrels_lock1[Squirrels_lock1$class == "2", ]$radtime, 
           B = Squirrels_lock1[Squirrels_lock1$class == "3", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
Squirrels_lock0 %>%
  group_by(class) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))

Squirrels_lock1 %>%
  group_by(class) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```


## Garden type
```{r}
CT_species_interest_hour_station %>%
  filter(Species == "Squirrel") %>%
  group_by(garden_type, hour_day) %>%
  dplyr::summarize(n_hour = sum(sum_hour)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = garden_type, fill = garden_type)) + 
  geom_line(size =2) + 
  scale_x_continuous(
    limits = c(0,23), 
    breaks = seq(0, 21, by = 3),
    expand = c(.001, .001)) + 
  scale_y_continuous(
    limits = c(0, 300),
    breaks = seq(0, 300, by = 50),
    expand = c(.01, .001)) +
  labs(x = "Hour of the day", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        #legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = pal_2) 
```

Overlap estimate
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Species == "Squirrel", ], 
                speciesA = "garden", 
                speciesB = "allotment", 
                speciesCol = "garden_type", 
                overlapEstimator = "Dhat4")
```

```{r}
overlapEst(A = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$garden_type == "garden", ]$radtime, 
           B = CT_species_interest[CT_species_interest$Species == "Squirrel" & CT_species_interest$garden_type == "allotment", ]$radtime, 
           kmax = 3, 
           type = "all")
```

Mean activity time
```{r}
CT_species_interest %>%
  filter(Species == "Squirrel") %>%
  group_by(garden_type) %>%
  dplyr::summarise(mean_act_time = hms::hms(seconds_to_period(mean(Time))))
```


## Dogs
```{r}
activityOverlap(recordTable = CT_species_interest[CT_species_interest$Species == "Squirrel", ], 
                speciesA = "0", 
                speciesB = "1", 
                speciesCol = "dogs_binary", 
                overlapEstimator = "Dhat4")
```

## Cats
```{r}
activityOverlap(recordTable = CT_species_interest, 
                speciesA = "Squirrel", 
                speciesB = "Cat", 
                speciesCol = "Species", 
                overlapEstimator = "Dhat4")
```

## Martens
```{r}
activityOverlap(recordTable = CT_species_interest, 
                speciesA = "Squirrel", 
                speciesB = "Marten", 
                speciesCol = "Species", 
                overlapEstimator = "Dhat4")
```


***

<details><summary>Session Info</summary>

```{r sessionInfo}
## DO NOT REMOVE!
## We store the settings of your computer and the current versions of the
## packages used to allow for reproducibility
Sys.time()
#git2r::repository() ## uncomment if you are using GitHub
sessionInfo()
```

</details>
