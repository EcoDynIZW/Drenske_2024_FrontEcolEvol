---
title: "Quick_test"
author: "Sinah Drenske"
date: "19 10 2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup
## Packages
```{r packages, message=FALSE, warning=FALSE}
## for non-CRAN packages please keep install instruction
## but commented so it is not run each time, e.g.
# devtools::install_github("EcoDynIZW/template")

## libraries used in this script
## please add ALL LIBRARIES NEEDED HERE
## please remove libraries from the list that are not needed anymore 
## at a later stage
package.list=c("camtrapR",
               "dplyr",
               "evaluate",
               "ggplot2",
               "gdata",
               "ggpubr",
               "here",
               "janitor",
               "lubridate",
               "maptools",
               # "optimbase", maybe needed but has to be installed from the CRAN archive https://cran.r-project.org/web/packages/optimbase/index.html
               "plyr",
               "raster",
               "readxl",
               #"rgdal",
               #"rgeos",
               #"rjags",
               "rlecuyer",
               #"sf",
               "showtext",
               "skimr",
               "snowfall",
               #"sp",
               "stringr",
               "tidyverse",
               "vroom"
               )

for (package in package.list) {
  if (!require(package, character.only=T, quietly=T)) {
    install.packages(package)
    library(package, character.only=T)
  }
}

```




## Data
```{r}
# julie_data <- readRDS(here::here("data-raw", "r-raw", "Old", "Louvrier_2021_JAE_UrbanMesocarnivores_Covariates_cameras_Dryad2021_10_29.RDS"))
# 
# julie_data2 <- readRDS(here::here("data-raw", "r-raw", "Old", "Louvrier_2021_JAE_UrbanMesocarnivores_Camera_detections_Dryad2021_11_05.RDS"))
```

```{r}
# ct_test <- unique(CT_act_date_formated[ ,2:3 ])
# table(ct_test$Season)
# table(stacked_raster_values_and_garden_CT_all_seasons_no_nas$project_phase)
# table(env_var2$project_phase)
```


# Exploratory data analysis
```{r}
# library("DataExplorer")
# library("tidyverse")
```


```{r}
# gss_cat
# 
# gss_cat %>% glimpse()
```

```{r}
# gss_cat %>% 
#   create_report(output_file = "gss_cat_data_profile_report", 
#                 output_dir = "", 
#                 y = "rincome", 
#                 report_title = "EDA Report - GSS data")
```


```{r}
# garden_variables %>% 
#   create_report(output_file = "garden_variables_data_report", 
#                 #output_dir = "", 
#                 #y = "rincome", 
#                 report_title = "EDA report of the garden variables")
```

# Import fonts
```{r}
# # Loading fonts (with package extrafont)
library(extrafont)
#font_import()
loadfonts(device = "win")
fonts()

```


```{r}
# windowsFonts()
# wf <- windowsFonts()
# names(wf[wf=="Roboto"])
```

```{r}
# ggplot(mtcars, aes(factor(cyl), fill = factor(vs))) +
#   geom_bar(position = "dodge")
# 
# ggplot(mtcars, aes(factor(cyl), fill = factor(vs))) +
#   geom_bar(position = "dodge2")
# 
# ggplot(mtcars, aes(factor(cyl), fill = factor(vs))) +
#   geom_bar(position = position_dodge(width = 0.9, preserve = "single"))
```

```{r}
rgb(red = 228, green =  202, blue =  165, maxColorValue = 255) # beige
rgb(red = 131, green =  116, blue =  097, maxColorValue = 255) # brown
rgb(red = 200, green =  054, blue =  073, maxColorValue = 255) # red
rgb(red = 077, green =  100, blue =  118, maxColorValue = 255) # greyblue
rgb(red = 048, green =  059, blue =  074, maxColorValue = 255) # darkdarkblue
```

# OLD CT per station
```{r}
# This data set is without zeros (because we do not need zeros for all species of interest)
CT_per_station <- CT_species_interest[, c(1,2,4:27)] %>%
  dplyr::count(Species, Station)  %>% 
  group_by(Species, Station) %>%
  dplyr::summarise(sum_pic = sum(n)) %>%
  ungroup() %>% 
  full_join(y = env_var[, c(1:20)], by = "Station") %>%
  droplevels()

# Overview
head(CT_per_station)
sum(CT_per_station$sum_pic) # 30090 = same as number of rows in CT_species_interest
summary(CT_per_station$sum_pic)


## Build a table only for squirrel pictures per station
# We have one row per camera. For cameras without any squirrel pictures we add a 0
CT_squirrels_station <- CT_species_interest[, c(1,2,4:27)] %>%
  dplyr::count(Species, Station)  %>% 
  group_by(Species, Station) %>%
  dplyr::summarise(sum_pic = sum(n)) %>%
  ungroup() %>% 
  filter(Species == "Squirrel") %>%
  full_join(y = env_var[, c(1:20)], by = "Station") %>%
  replace_na(list(Species = "Squirrel", sum_pic = 0)) %>%
  droplevels()

# Overview
head(CT_squirrels_station)
sum(CT_squirrels_station$sum_pic) # 1867 = same as number of rows in CT_squirrels
summary(CT_squirrels_station$sum_pic)
```




# 3a Description plots
```{r}
# Garden type
ggplot(data = CT_squirrels_station, mapping = aes(x = garden_type, y = n)) + 
  stat_halfeye(mapping = aes(
    color = garden_type, 
    fill = after_scale(lighten(color, .5))),
    width = 0.75, 
    .width = 0, 
    adjust = 0.5, 
    justification = -.3,
    point_color = NA) +
  geom_boxplot(mapping = aes(
    color = garden_type, 
    color = after_scale(darken(color, .1, space = "HLS")),
    fill = after_scale(desaturate(lighten(color, .8), .4))), 
    width = 0.32, 
    outlier.shape = NA) +
  # geom_point(mapping = aes(
  #   color = garden_type, 
  #   color = after_scale(darken(color, .1, space = "HLS"))), 
  #   fill = "white", 
  #   shape = 21, 
  #   size = 2, 
  #   stroke = .4,
  #   position = position_jitter(seed = 1, width = 0.12)) +
  geom_point(mapping = aes(
    fill = garden_type), 
    color = "transparent", 
    shape = 21, 
    size = 3, 
    stroke = .4,
    alpha = .5,
    position = position_jitter(seed = 1, width = 0.12)) + 
  stat_summary(
    geom = "text",
    fun = "median",
    aes(label = round(..y.., 2),
        color = garden_type,
        color = after_scale(darken(color, .1, space = "HLS"))),
    family = "Roboto",
    fontface = "bold",
    size = 5,
    vjust = -3.5) + 
  annotate(geom="text", family = "Roboto", 
           x=2.4, y=30, 
           label="n = 185",
           color=after_scale(darken("#572F22", .1, space = "HLS")), size = 4) + 
  annotate(geom="text", family = "Roboto", 
           x=1.4, y=30, 
           label="n = 44",
           color=after_scale(darken("#CD524C", .1, space = "HLS")), size = 4) + 
  coord_flip(clip = "off") + 
  scale_y_continuous(
    limits = c(-5, 200),
    breaks = seq(0, 200, by = 50),
    expand = c(.001, .001)) + 
  labs(x = "Garden type", 
       y = "Number of pictures") + 
  theme_pubr() + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(), 
        legend.position = "none", 
        panel.background = element_rect(fill = "white"), 
        plot.background = element_rect(fill = "white"),
        panel.border = element_rect(colour = "black", fill=NA, size=2), 
        axis.ticks = element_line(colour = "black", linewidth = 2), 
        axis.ticks.length = unit(0.25, "cm"), 
        plot.margin = margin(6, 10, 4, 4)) + 
  labs_pubr(base_family = "Zilla Slab", base_size = 15) + 
  font(object = "xy.text", family = "Roboto", size = 11) + 
  scale_colour_manual(values = scico(2, palette = "lajolla", begin = 0.6, end = 0.85), guide = "none") +
  scale_fill_manual(values = scico(2, palette = "lajolla", begin = 0.6, end = 0.85), guide = "none") + 
  scale_x_discrete(expand = c(0.2, 0.001))
```

facet wraps
```{r}
# in Theme
# strip.text = element_text(size = 11, face = "bold"), 
# strip.background = element_rect(colour = "black", fill=NA, linewidth=2),
# 
# # Am Ende
# facet_wrap(~dogs_binary, labeller = labeller(dogs_binary = dogcat_labs))
# 
# 
# facet_wrap(~cats_binary, labeller = labeller(dogs_binary = dogcat_labs))

```

# Summary tables
```{r}
CT_per_species_season_day <- CT_species_interest %>% 
  dplyr::count(Species, Season, Date) %>%
  group_by(Species, Season) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_day = mean(n), 
                   median_day = median(n), 
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species_season_day

CT_per_species_season_station <- CT_species_interest %>% 
  dplyr::count(Species, Season, Station) %>%
  group_by(Species, Season) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_cam = mean(n), 
                   median_cam = median(n), 
                   sd_cam = sd(n),
                   min_cam = min(n), 
                   max_cam = max(n))

CT_per_species_season_station

CT_per_species_phase_day <- CT_species_interest %>% 
  dplyr::count(Species, project_phase, Date) %>%
  group_by(Species, project_phase) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_day = mean(n), 
                   median_day = median(n), 
                   sd_day = sd(n),
                   min_day = min(n), 
                   max_day = max(n))

CT_per_species_phase_day

CT_per_species_phase_station <- CT_species_interest %>% 
  dplyr::count(Species, project_phase, Station) %>%
  group_by(Species, project_phase) %>% 
  dplyr::summarize(n_overall = sum(n), 
                   mean_cam = mean(n), 
                   median_cam = median(n), 
                   sd_cam = sd(n),
                   min_cam = min(n), 
                   max_cam = max(n))

CT_per_species_phase_station
```


# Overlap plots + calculation
```{r}
# dat$time <- (hour(dat$DateTime)*60 + minute(dat$DateTime))/(24*60)  #time of day as fraction
# dat$radtime <- dat$time * 2 * pi

# transform hours to minutes + minutes / minutes of a day
# CT_squirrels$minute_day <- (hour(CT_squirrels$DateTimeOriginal)*60 + minute(CT_squirrels$DateTimeOriginal))
# CT_squirrels$tot_min <- 24*60
# CT_squirrels$time_frac2 <- CT_squirrels$minute_day / CT_squirrels$tot_min

CT_squirrels$time_frac <- (hour(CT_squirrels$DateTimeOriginal)*60 + minute(CT_squirrels$DateTimeOriginal))/(24*60)
# CT_squirrels$seconds_day <- period_to_seconds(hms(CT_squirrels$Time))
# CT_squirrels$time_frac_s <- CT_squirrels$seconds_day / (24*60*60)
# CT_squirrels$radtime_s <- CT_squirrels$time_frac_s * 2 * pi
# CT_squirrels$rad_s_reverse <- CT_squirrels$radtime_s / 2 / pi 
# CT_squirrels$time_frac_s_reverse <- CT_squirrels$rad_s_reverse * (24*60*60)
# CT_squirrels$time_s_reverse <- seconds_to_period(CT_squirrels$time_frac_s_reverse)


# calculate the radiated time
CT_squirrels$radtime <- CT_squirrels$time_frac * 2 * pi
CT_squirrels$radtime
# CT_squirrels$rad_reverse <- CT_squirrels$radtime / 2 / pi 
# CT_squirrels$minute_day_reverse <- CT_squirrels$rad_reverse * CT_squirrels$tot_min
# CT_squirrels$seconds <- CT_squirrels$minute_day_reverse * 60
# CT_squirrels$time_interest <- seconds_to_period(CT_squirrels$seconds)
# minutes

#CT_squirrels <- sf::st_drop_geometry(CT_squirrels)
CT_squirrels_dogs <- CT_squirrels[CT_squirrels$dogs_binary == 1, ]$radtime_s
CT_squirrels_no_dogs <- CT_squirrels[CT_squirrels$dogs_binary == 0, ]$radtime_s
(mean(CT_squirrels_dogs) / 2 / pi)  # = time_frac
mean(CT_squirrels_no_dogs) / 2 / pi

(mean(CT_squirrels_dogs) / 2 / pi)  # = time_frac
seconds_to_period(((mean(CT_squirrels_no_dogs) / 2 / pi))*(24*60*60))

CT_squirrels %>%
  group_by(dogs_binary) %>%
  dplyr::summarise(mean_act_time = seconds_to_period(mean(Time)))
CT_squirrels %>%
  group_by(dogs_binary) %>%
  dplyr::summarise(mean_act_time = seconds_to_period(
    mean(
      period_to_seconds(
        hms(Time)))))

```

```{r}
test <- CT_squirrels %>%
  mutate(time_frac = (hour(CT_squirrels$DateTimeOriginal)*60 + minute(CT_squirrels$DateTimeOriginal))/(24*60), 
         radtime = time_frac * 2 * pi)

test %>% 
  group_by(dogs_binary) %>%
  overlapEst(A = radtime, kmax = 3, type = "all")

overlapEst(A = tiger)
```

```{r}
CT_species_station_mean_hour %>%
  group_by(Species, lockdown) %>%
  dplyr::summarise(mean_pics = mean(mean_hour))

CT_species_station_mean_hour
```
```{r}
CT_species_station_mean_hour$time_frac <- (CT_species_station_mean_hour$hour_day*60)/(24*60)
CT_species_station_mean_hour$radtime <- CT_species_station_mean_hour$time_frac * 2 * pi
```




```{r}
CT_squirrels_autumn <- CT_squirrels[CT_squirrels$Season == "autumn", ]$radtime
CT_squirrels_spring <- CT_squirrels[CT_squirrels$Season == "spring", ]$radtime
overlapEst(A = CT_squirrels_autumn, B = CT_squirrels_spring, kmax = 1, type = "all")

c1<-c(1:1000)
c2<-c(501:1500)
overlapEst(A = c1, B = c2, type = "all")

tryit<-CT_squirrels%>%
  ungroup()%>%
  group_by(Season,as.factor(hour_day))%>%
  mutate(time_frac = (hour_day/24), radtime = time_frac*2*pi) %>%
  dplyr::summarise(mean_nr_pics=mean(mean_hour))
  
A <- tryit%>%filter(Season=="spring")


  
B = tryit%>%filter(Season=="autumn")


df<-rbind(A,B)

ggplot(df)+
  geom_line(aes(x=df$`as.factor(hour_day)`,y=mean_nr_pics,group=Season))


o<-A/B
A <- tryit%>%filter(Season=="spring")%>%pull(mean_nr_pics)
B <- tryit%>%filter(Season=="autumn")%>%pull(mean_nr_pics)
intersect(A,B)

CT_squirrels$hour_day <- as.factor(CT_squirrels$hour_day)
library(camtrapR)
camtrapR::activityOverlap(recordTable = CT_squirrels, 
                          speciesCol = "Season", 
                          speciesA = "spring", 
                          speciesB = "autumn", 
                          recordDateTimeCol = "hour_day", 
                          recordDateTimeFormat = "H")
```

```{r}
dens <- density(CT_squirrels_autumn)
dens
```

```{r}
(x <- c(sort(sample(1:20, 9)), NA))
(y <- c(sort(sample(3:23, 7)), NA))
x
y
union(x, y)
intersect(x, y)
setdiff(x, y)
setdiff(y, x)
setequal(x, y)
```


# Overlap plots new next try
```{r}
as.Date()
CT_squirrels$hour_day_overlap <- as.POSIXct(x = paste(CT_squirrels$hour_day, 00, sep=":"), 
                                            format = "%H:%M", 
                                            tz = "GMT")

```

```{r}
camtrapR::activityOverlap(recordTable = CT_squirrels, 
                          speciesCol = "Season", 
                          speciesA = "spring", 
                          speciesB = "autumn", 
                          recordDateTimeCol = "hour_day_overlap", 
                          recordDateTimeFormat = "ymd HMS")

camtrapR::activityOverlap(recordTable = CT_species_interest, 
                          speciesCol = "Species", 
                          speciesA = "Squirrel", 
                          speciesB = "Cat", 
                          recordDateTimeCol = "DateTimeOriginal", 
                          recordDateTimeFormat = "ymd HMS")

camtrapR::activityDensity(recordTable = CT_squirrels, species = "Squirrel", recordDateTimeCol = "hour_day_overlap", recordDateTimeFormat = "ymd HMS")

camtrapR::activityDensity(recordTable = CT_species_interest, species = "Squirrel", recordDateTimeCol = "DateTimeOriginal", recordDateTimeFormat = "ymd HMS")
```
```{r}
?overlap::overlapEst
overlapEst(A = CT_squirrels_autumn, B = CT_squirrels_spring, kmax = 1, type = "all")
```

```{r}
overlap::overlapEst
```


```{r}
camtrapR::activityOverlap
```

## activity package
```{r}
#install.packages('activity')
#library(activity)
# fitact
?fitact
data(BCItime)
```


```{r}
tm <- 2*pi*subset(BCItime, species=="brocket")$time
weight <- 1/ifelse(tm>pi/2 & tm<pi*3/2, 1.2, 1)
tm
weight

mod1 <- fitact(tm)
mod2 <- fitact(tm, sample="data", reps=10)
mod3 <- fitact(tm, wt=weight)
plot(mod1)
plot(mod2)
plot(mod3)
?BCItime
cmean(tm)
times <- subset(BCItime, species=="ocelot")$time*2*pi 
cmean(times)
```


```{r}
tPaca <- 2*pi*BCItime$time[BCItime$species=="ocelot"] 
tRat <- 2*pi*BCItime$time[BCItime$species=="rat"] 
fPaca <- fitact(tPaca, sample="data", reps=10) 
fRat <- fitact(tRat, sample="data", reps=10) 
fPaca@act 
fRat@act 
compareAct(list(fPaca,fRat))
compareCkern(fPaca,fRat,reps=10)
```

```{r}
head(BCItime$date)
rtime <- gettime(BCItime$date, "%d/%m/%Y %H:%M", "radian") 
htime <- gettime(BCItime$date, "%d/%m/%Y %H:%M", "hour") 
ptime <- gettime(BCItime$date, "%d/%m/%Y %H:%M", "proportion") 
summary(rtime) 
summary(htime) 
summary(ptime)

trat2 <- gettime(BCItime$date[BCItime$species=="rat"], "%d/%m/%Y %H:%M", "radian")
```

```{r}
oceAct <- fitact(subset(BCItime, species=="ocelot")$time*2*pi) 
broAct <- fitact(subset(BCItime, species=="brocket")$time*2*pi) 
ovl4(oceAct, broAct)
```


### My data
```{r}

tm <- 2*pi*subset(BCItime, species=="brocket")$time
rtime <- gettime(BCItime$date, "%d/%m/%Y %H:%M", "radian") 

mod3 <- fitact(tm, wt=weight)

```

```{r}
CT_squirrels$time_rad <- gettime(x = CT_squirrels$hour_day_overlap, format = "%Y-%m-%d %H:%M:%S", scale = "radian")
```


```{r}
mod_squirrel_spring <- fitact(dat =subset(CT_squirrels, Season == "spring")$time_rad, 
                              wt = subset(CT_squirrels, Season == "spring")$mean_hour, 
                              sample = "data")
mod_squirrel_autumn <- fitact(dat =subset(CT_squirrels, Season == "autumn")$time_rad, 
                              wt = subset(CT_squirrels, Season == "autumn")$mean_hour, 
                              sample = "data")
```


```{r}
ovl4(mod_squirrel_spring, mod_squirrel_autumn) # 0.9999995 That cannot be true or???
overlap::overlapEst(A = subset(CT_squirrels, Season == "spring")$time_rad, B = subset(CT_squirrels, Season == "autumn")$time_rad)
compareAct(list(mod_squirrel_spring,mod_squirrel_autumn))
compareCkern(mod_squirrel_spring,mod_squirrel_autumn,reps=10)
plot(mod_squirrel_spring)
plot(mod_squirrel_autumn)
```
### Test species interest
```{r}
camtrapR::activityOverlap(recordTable = CT_species_interest, 
                          speciesCol = "Species", 
                          speciesA = "Squirrel", 
                          speciesB = "Cat", 
                          recordDateTimeCol = "DateTimeOriginal", 
                          recordDateTimeFormat = "ymd HMS")
```

```{r}
CT_species_interest$time_rad <- gettime(x = CT_species_interest$DateTimeOriginal, format = "%Y-%m-%d %H:%M:%S", scale = "radian")
```


```{r}
mod_squirrel_all <- fitact(dat = subset(CT_species_interest, Species == "Squirrel")$time_rad, 
                           #wt = subset(CT_species_interest, Species == "Squirrel")$mean_hour, 
                           sample = "data")
mod_cat_all <- fitact(dat = subset(CT_species_interest, Species == "Cat")$time_rad, 
                      #wt = subset(CT_species_interest, Species == "Cat")$mean_hour, 
                      sample = "data")
ovl4(mod_squirrel_all, mod_cat_all) 
overlap::overlapEst(A = subset(CT_species_interest, Species == "Squirrel")$time_rad, 
                    B = subset(CT_species_interest, Species == "Cat")$time_rad)
```


# Plot


```{r}
library(overlap)
overlapEst(A = CT_squirrels_dogs, B = CT_squirrels_no_dogs, kmax = 3, type = "all")
#overlap::overlapEst
overlapEst(A = CT_squirrels_no_dogs, B = CT_squirrels_dogs, kmax = 3, type = "all")
tigmac <- overlapPlot(CT_squirrels_no_dogs, CT_squirrels_dogs)

ggplot(tigmac, aes(x)) +
  geom_area(aes(y = pmin(densityA, densityB)),
            alpha = 0.3) +
  geom_line(aes(y = densityA, colour = "A")) +
  geom_line(aes(y = densityB, colour = "B"))
```

```{r}
df <- data.frame(
  g = c("a", "a", "a", "b", "b", "b"),
  x = c(1, 3, 5, 2, 4, 6),
  y = c(2, 5, 1, 3, 6, 7)
)
a <- ggplot(df, aes(x, y, fill = g)) +
  geom_area()
a

ggplot(states, aes(x = year, group=1)) + 
  geom_line(aes(y = ttc_avg),colour='#006f91') +
  geom_line(aes(y = nat_avg), colour='#666666') +
  geom_ribbon(aes(x=year, ymin = nat_avg, ymax = ttc_avg, fill=ttc_avg > nat_avg)) +
  scale_fill_manual(values=c("green", "red"), name="fill") +
  facet_wrap(~state)
```

```{r}
squirrels_CT %>%
  group_by(Season, hour_day) %>%
  dplyr::summarize(n_hour = sum(n)) %>%
  complete(hour_day = c(0:23), fill = list(n_hour = 0)) %>%
  ungroup() %>%
  ggplot(mapping = aes(x = hour_day, y = n_hour, colour = Season, fill = Season)) + 
  geom_line(size =2) + 
  geom_area(aes(y = pmin(n_hour)),
            alpha = 0.3)
```


# Mean activity time
```{r}
mean_squirrel_time2 <- CT_squirrels$Time %>%
  hms() %>%
  period_to_seconds() %>%
  mean() %>%
  seconds_to_period()

mean_squirrel_time
mean_squirrel_time2

typeof(CT_squirrels$Time)
class(CT_squirrels$Time)
```



# Activity plots old
#### Old
```{r}
CT_data_lockdown <- split(x = CT_squirrels, f = CT_squirrels$lockdown)
```

```{r}
# Kleingarten
activityDensity(recordTable = CT_data_lockdown[[1]], 
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3)) # no lockdown
# Grundstück
activityDensity(recordTable = CT_data_lockdown[[2]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3)) # lockdown

# Overlap plot
activityOverlap(recordTable = CT_squirrels, speciesA = 0, speciesB = 1, speciesCol = "lockdown")
```

#### per project phase
```{r}
CT_data_per_phase <- split(x = CT_act_date_proc, f = CT_act_date_proc$project_phase)
CT_data_phase1 <- as.data.frame(CT_data_per_phase[[1]])
CT_data_phase2 <- as.data.frame(CT_data_per_phase[[2]])
CT_data_phase3 <- as.data.frame(CT_data_per_phase[[3]])
CT_data_phase4 <- as.data.frame(CT_data_per_phase[[4]])
CT_data_phase5 <- as.data.frame(CT_data_per_phase[[5]])
```

```{r}
activityRadial(recordTable = CT_data_phase1, 
               species = "Squirrel", 
               rp.type = "p", 
               lwd = 3, 
               radial.lim = c(0,0.25))
# activityRadial(recordTable = CT_data_per_season[[1]], 
#                species = "Squirrel", 
#                lwd = 3)
activityRadial(recordTable = CT_data_phase2, species = "Squirrel", rp.type = "p", lwd = 3, radial.lim = c(0,0.25))
activityRadial(recordTable = CT_data_phase3, species = "Squirrel", rp.type = "p", lwd = 3, radial.lim = c(0,0.25))
activityRadial(recordTable = CT_data_phase4, species = "Squirrel", rp.type = "p", lwd = 3, radial.lim = c(0,0.25))
activityRadial(recordTable = CT_data_phase5, species = "Squirrel", rp.type = "p", lwd = 3, radial.lim = c(0,0.25))

################## Same scale for all seasons
################## overlap plots
#activityOverlap(recordTable = CT_data_per_phase, speciesA = CT_data_per_phase[[1]], speciesB = CT_data_per_phase[[2]])
```

```{r}
activityDensity(recordTable = CT_data_phase1, species = "Squirrel", 
               ylim = c(0,0.2))
activityDensity(recordTable = CT_data_phase2, species = "Squirrel", 
               ylim = c(0,0.2))
activityDensity(recordTable = CT_data_phase3, species = "Squirrel", 
               ylim = c(0,0.2))
activityDensity(recordTable = CT_data_phase4, species = "Squirrel", 
               ylim = c(0,0.2))
activityDensity(recordTable = CT_data_phase5, species = "Squirrel", 
               ylim = c(0,0.2))
```


```{r}
# activityRadial(recordTable = CT_act_date_proc, 
#                species = "Squirrel", 
#                lwd = 3)
# activityRadial(recordTable = CT_act_date_proc, 
#                species = "Squirrel", 
#                lwd = 3, 
#                line.col = "black", rad.col = "grey", 
#                grid.col = "grey", 
#                grid.bg = "white")
```

#### per garden type
```{r}
CT_data_garden_type <- split(x = CT_squirrels, f = CT_squirrels$garden_type)
```

```{r}
# Kleingarten
activityRadial(recordTable = CT_data_garden_type[[1]],
               species = "Squirrel",
               lwd = 3, 
               radial.lim = c(0,0.25))
# Grundstück
activityRadial(recordTable = CT_data_garden_type[[2]],
               species = "Squirrel",
               lwd = 3, 
               radial.lim = c(0,0.25))

# Kleingarten
activityDensity(recordTable = CT_data_garden_type[[1]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.15))
# Grundstück
activityDensity(recordTable = CT_data_garden_type[[2]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.15))
```

#### imperviousness
```{r}
CT_with_garden_var <- CT_act_date_proc %>%
  left_join(y = env_var, by = "Station")

CT_squirrels <- CT_with_garden_var %>% 
  filter(Species == "Squirrel")

CT_squirrels$imperv_class <- 
  ifelse(test = CT_squirrels$imperviousness_2018 <20, 
         yes = 1, 
         no = ifelse(test = CT_squirrels$imperviousness_2018 <40, 
                     yes = 2, 
                     no = ifelse(test = CT_squirrels$imperviousness_2018 <60, 
                                 yes = 3, 
                                 no = ifelse(test = CT_squirrels$imperviousness_2018 <80, 
                                             yes = 4, 
                                             no = ifelse(test = CT_squirrels$imperviousness_2018 <101, 
                                                         yes = 5, 
                                                         no = 99)))))

CT_squirrels$tree_cov_class <- 
  ifelse(test = CT_squirrels$tree_cover_100 <20, 
         yes = 1, 
         no = ifelse(test = CT_squirrels$tree_cover_100 <40, 
                     yes = 2, 
                     no = ifelse(test = CT_squirrels$tree_cover_100 <60, 
                                 yes = 3, 
                                 no = ifelse(test = CT_squirrels$tree_cover_100 <80, 
                                             yes = 4, 
                                             no = ifelse(test = CT_squirrels$tree_cover_100 <101, 
                                                         yes = 5, 
                                                         no = 99)))))

CT_squirrels$pop_class <- 
  ifelse(test = CT_squirrels$population_density_2019 <100, 
         yes = 1, 
         no = ifelse(test = CT_squirrels$population_density_2019 <200, 
                     yes = 2, 
                     no = ifelse(test = CT_squirrels$population_density_2019 <300, 
                                 yes = 3, 
                                 no = ifelse(test = CT_squirrels$population_density_2019 <700, 
                                             yes = 4, 
                                             no = 99))))

```


```{r}
CT_data_imperv <- split(x = CT_squirrels, f = CT_squirrels$imperv_class)
```

```{r}
# 1
activityDensity(recordTable = CT_data_imperv[[1]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3))
# 2
activityDensity(recordTable = CT_data_imperv[[2]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3))
# 3
activityDensity(recordTable = CT_data_imperv[[3]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3))
# 4
activityDensity(recordTable = CT_data_imperv[[4]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3))
# 5
activityDensity(recordTable = CT_data_imperv[[5]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.3))
```
#### tree cover
```{r}
CT_data_tree <- split(x = CT_squirrels, f = CT_squirrels$tree_cov_class)
```

```{r}
# 1
activityDensity(recordTable = CT_data_tree[[1]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 2
activityDensity(recordTable = CT_data_tree[[2]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 3
activityDensity(recordTable = CT_data_tree[[3]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 4
activityDensity(recordTable = CT_data_tree[[4]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 5
activityDensity(recordTable = CT_data_tree[[5]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
```


#### population density
```{r}
# CT_squirrels$pop_class <- 
#   ifelse(test = CT_squirrels$pop_100 <100, 
#          yes = 1, 
#          no = ifelse(test = CT_squirrels$pop_100 <200, 
#                      yes = 2, 
#                      no = ifelse(test = CT_squirrels$pop_100 <300, 
#                                  yes = 3, 
#                                  no = ifelse(test = CT_squirrels$pop_100 <700, 
#                                              yes = 4, 
#                                              no = 99))))

CT_data_pop <- split(x = CT_squirrels, f = CT_squirrels$pop_class)
```

```{r}
# 1
activityDensity(recordTable = CT_data_pop[[1]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 2
activityDensity(recordTable = CT_data_pop[[2]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 3
activityDensity(recordTable = CT_data_pop[[3]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
# 4
activityDensity(recordTable = CT_data_pop[[4]],
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.4))
```

#### dogs
```{r}
CT_data_dogs <- split(x = CT_squirrels, f = CT_squirrels$dogs_binary)
```

```{r}
# 1
activityDensity(recordTable = CT_data_dogs[[1]], # no dog
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.2))
# 2
activityDensity(recordTable = CT_data_dogs[[2]], # dog
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.2))
```


```{r}
table(CT_squirrels$dogs_binary)
table(CT_squirrels$dogs_binary, CT_squirrels$project_phase)
```
Per project phase (we can see this in the overlap plots)
```{r}
# activityDensity(recordTable = CT_data_dogs[[1]], # no dog
#                species = 1, 
#                speciesCol = "project_phase",
#                lwd = 3, 
#                ylim = c(0,0.2))
# # 2
# activityDensity(recordTable = CT_data_dogs[[1]], # no dog
#                species = 2, 
#                speciesCol = "project_phase",
#                lwd = 3, 
#                ylim = c(0,0.2))
# 
# activityDensity(recordTable = CT_data_dogs[[1]], # no dog
#                species = 3, 
#                speciesCol = "project_phase",
#                lwd = 3, 
#                ylim = c(0,0.2))
# 
# activityDensity(recordTable = CT_data_dogs[[1]], # no dog
#                species = 4, 
#                speciesCol = "project_phase",
#                lwd = 3, 
#                ylim = c(0,0.2))
# 
# activityDensity(recordTable = CT_data_dogs[[1]], # no dog
#                species = 5, 
#                speciesCol = "project_phase",
#                lwd = 3, 
#                ylim = c(0,0.2))
```

##### Overlap plots
```{r}
activityOverlap(recordTable = CT_squirrels, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary")
```

```{r}
# dogs vs no dogs per season
CT_data_per_season <- split(x = CT_squirrels, f = CT_squirrels$Season)
CT_data_autumn <- as.data.frame(CT_data_per_season[[1]])
CT_data_spring <- as.data.frame(CT_data_per_season[[2]])

# spring
activityOverlap(recordTable = CT_data_spring, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.2))

# Autumn
activityOverlap(recordTable = CT_data_autumn, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.2))

```
Per project phase
```{r}
CT_data_per_phase <- split(x = CT_squirrels, f = CT_squirrels$project_phase)
CT_data_phase1 <- as.data.frame(CT_data_per_phase[[1]])
CT_data_phase2 <- as.data.frame(CT_data_per_phase[[2]])
CT_data_phase3 <- as.data.frame(CT_data_per_phase[[3]])
CT_data_phase4 <- as.data.frame(CT_data_per_phase[[4]])
CT_data_phase5 <- as.data.frame(CT_data_per_phase[[5]])
```

```{r}
# Phase 1
activityOverlap(recordTable = CT_data_phase1, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.25))

# Phase 2
activityOverlap(recordTable = CT_data_phase2, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.25))

# Phase 3
activityOverlap(recordTable = CT_data_phase3, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.25))

# Phase 4
activityOverlap(recordTable = CT_data_phase4, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.25))

# Phase 5
activityOverlap(recordTable = CT_data_phase5, speciesA = 0, speciesB = 1, speciesCol = "dogs_binary", ylim = c(0,0.25))
```


#### cats
```{r}
CT_data_cats <- split(x = CT_squirrels, f = CT_squirrels$cats_binary)
table(CT_squirrels$cats_binary)
table(CT_squirrels$cats_binary, CT_squirrels$project_phase)
```

```{r}
# 1
activityDensity(recordTable = CT_data_cats[[1]], # no cat
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.2))
# 2
activityDensity(recordTable = CT_data_cats[[2]], # cat
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.2))
```

#### trees of interest
```{r}
CT_data_tree_interest <- split(x = CT_squirrels, f = CT_squirrels$trees_of_interest)
```

```{r}
# 1
activityDensity(recordTable = CT_data_tree[[1]], # no trees of interest
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.2))
# 2
activityDensity(recordTable = CT_data_tree[[2]], # with trees of interest
               species = "Squirrel",
               lwd = 3, 
               ylim = c(0,0.2))
```

### Save data
We save the combined dataset of camera trap detections and the environmental variables
```{r}
# # CT_with_garden_var
# saveRDS(object = CT_with_garden_var,
#         file = here::here("output", "data-proc", "all_seasons", "CT_with_garden_var_20230106.RDS"))
# 
# # CT_squirrels
# saveRDS(object = CT_squirrels,
#         file = here::here("output", "data-proc", "all_seasons", "CT_squirrels_with_garden_var_20230106.RDS"))
# 
# # CT_squirrels_station
# saveRDS(object = CT_squirrels_station,
#         file = here::here("output", "data-proc", "all_seasons", "CT_squirrels_station_with_garden_var_20230106.RDS"))
```

# Old Script 1

## - NOT USED - Dataset of the activity per Station per weekend or weekday 
We calculated the activity (nr of photos per species) per station and divided if the photos were taken during the week or during the weekend

```{r weekdays weekends}

# #filter by date
# P1 <- activity_data %>% filter(Date >= list_date_monthly[[1]][1] & Date <= list_date_monthly[[1]][2])
# P2 <- activity_data %>% filter(Date >= list_date_monthly[[2]][1] & Date <= list_date_monthly[[2]][2])
# P3 <- activity_data %>% filter(Date >= list_date_monthly[[3]][1] & Date <= list_date_monthly[[3]][2])
# P4 <- activity_data %>% filter(Date >= list_date_monthly[[4]][1] & Date <= list_date_monthly[[4]][2])
# P5 <- activity_data %>% filter(Date >= list_date_monthly[[5]][1] & Date <= list_date_monthly[[5]][2])
# 
# #separating for weekends and weekdays
# P1_weekdays <- P1 %>% dplyr::filter(weekdays_binary == 1)
# P1_weekends <- P1 %>% dplyr::filter(weekdays_binary == 0)
# 
# P2_weekdays <- P2 %>% dplyr::filter(weekdays_binary == 1)
# P2_weekends <- P2 %>% dplyr::filter(weekdays_binary == 0)
# 
# P3_weekdays <- P3 %>% dplyr::filter(weekdays_binary == 1)
# P3_weekends <- P3 %>% dplyr::filter(weekdays_binary == 0)
# 
# P4_weekdays <- P4 %>% dplyr::filter(weekdays_binary == 1)
# P4_weekends <- P4 %>% dplyr::filter(weekdays_binary == 0)
# 
# P5_weekdays <- P5 %>% dplyr::filter(weekdays_binary == 1)
# P5_weekends <- P5 %>% dplyr::filter(weekdays_binary == 0)
```

```{r activity function}
#function for counting the number of pictures for each species
# activity <- function(species, CT)
# {
#   CT_species <- CT %>% filter(Species == species)
# 
#   Unique_CT <- unique(CT_species$Station)
#   l <- list(0)
# 
#   for(i in Unique_CT)
#     {
#       l[[which(Unique_CT == i)]] <- 
#       nrow(CT_species %>% filter(Station == i)) 
#      #% of pictures taken during the night
#       names(l)[which(Unique_CT == i)] <- as.character(i)
#        }
#    x <- data.frame(unlist(l))
#    x <- dplyr::rename(x, activity = unlist.l.)
#    x <- x %>% mutate(User_uid = as.numeric(rownames(x)))
#    x_covenv <- dplyr::inner_join(x = x,
#                                  y = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
#                                  by = c("User_uid" = "Station")) 
#                 #merging with the covenv
#    return(x_covenv)
# 
# }
```

### Create a table per species per phase/season per weekdays/weekend
```{r table per species per season per weekends/weekdays}
# ## P1
# squirrel_P1_activity_weekdays <- activity("Squirrel", P1_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P1_activity_weekends <- activity("Squirrel", P1_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P1_activity_weekdays <- activity("Cat", P1_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P1_activity_weekends <- activity("Cat", P1_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P1_activity_weekdays <- activity("Red Fox", P1_weekdays) %>%
#   mutate(species = "Red Fox", weekdays = 1)
# fox_P1_activity_weekends <- activity("Red Fox", P1_weekends) %>%
#   mutate(species = "Red Fox", weekdays = 0)
# 
# marten_P1_activity_weekdays <- activity("Marten", P1_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P1_activity_weekends <- activity("Marten", P1_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P1_activity_weekdays <- activity("Raccoon", P1_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P1_activity_weekends <- activity("Raccoon", P1_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# ## P2
# squirrel_P2_activity_weekdays <- activity("Squirrel", P2_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P2_activity_weekends <- activity("Squirrel", P2_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P2_activity_weekdays <- activity("Cat", P2_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P2_activity_weekends <- activity("Cat", P2_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P2_activity_weekdays <- activity("Red Fox", P2_weekdays) %>%
#   mutate(species = "Red Fox", weekdays = 1)
# fox_P2_activity_weekends <- activity("Red Fox", P2_weekends) %>%
#   mutate(species = "Red Fox", weekdays = 0)
# 
# marten_P2_activity_weekdays <- activity("Marten", P2_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P2_activity_weekends <- activity("Marten", P2_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P2_activity_weekdays <- activity("Raccoon", P2_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P2_activity_weekends <- activity("Raccoon", P2_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# ## P3
# squirrel_P3_activity_weekdays <- activity("Squirrel", P3_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P3_activity_weekends <- activity("Squirrel", P3_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P3_activity_weekdays <- activity("Cat", P3_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P3_activity_weekends <- activity("Cat", P3_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P3_activity_weekdays <- activity("Red Fox", P3_weekdays) %>%
#   mutate(species = "Red Fox", weekdays = 1)
# fox_P3_activity_weekends <- activity("Red Fox", P3_weekends) %>%
#   mutate(species = "Red Fox", weekdays = 0)
# 
# marten_P3_activity_weekdays <- activity("Marten", P3_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P3_activity_weekends <- activity("Marten", P3_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P3_activity_weekdays <- activity("Raccoon", P3_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P3_activity_weekends <- activity("Raccoon", P3_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# #P4
# squirrel_P4_activity_weekdays <- activity("Squirrel", P4_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P4_activity_weekends <- activity("Squirrel", P4_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P4_activity_weekdays <- activity("Cat", P4_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P4_activity_weekends <- activity("Cat", P4_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P4_activity_weekdays <- activity("Red Fox", P4_weekdays) %>%
#   mutate(species = "Red Fox", weekdays = 1)
# fox_P4_activity_weekends <- activity("Red Fox", P4_weekends) %>%
#   mutate(species = "Red Fox", weekdays = 0)
# 
# marten_P4_activity_weekdays <- activity("Marten", P4_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P4_activity_weekends <- activity("Marten", P4_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P4_activity_weekdays <- activity("Raccoon", P4_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P4_activity_weekends <- activity("Raccoon", P4_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# #P5
# squirrel_P5_activity_weekdays <- activity("Squirrel", P5_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P5_activity_weekends <- activity("Squirrel", P5_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P5_activity_weekdays <- activity("Cat", P5_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P5_activity_weekends <- activity("Cat", P5_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P5_activity_weekdays <- activity("Red Fox", P5_weekdays) %>%
#   mutate(species = "Red Fox", weekdays = 1)
# fox_P5_activity_weekends <- activity("Red Fox", P5_weekends) %>%
#   mutate(species = "Red Fox", weekdays = 0)
# 
# marten_P5_activity_weekdays <- activity("Marten", P5_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P5_activity_weekends <- activity("Marten", P5_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P5_activity_weekdays <- activity("Raccoon", P5_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P5_activity_weekends <- activity("Raccoon", P5_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# # Combine all data sets
# Activity_squirrel_pred_Berlin_all_seasons <- 
#   rbind(# P1
#     squirrel_P1_activity_weekdays, squirrel_P1_activity_weekends, 
#     cat_P1_activity_weekdays,cat_P1_activity_weekends,
#     fox_P1_activity_weekdays,fox_P1_activity_weekends,
#     marten_P1_activity_weekdays,marten_P1_activity_weekends,
#     raccoon_P1_activity_weekdays,raccoon_P1_activity_weekends,
#     # P2
#     squirrel_P2_activity_weekdays, squirrel_P2_activity_weekends, 
#     cat_P2_activity_weekdays, cat_P2_activity_weekends, 
#     fox_P2_activity_weekdays, fox_P2_activity_weekends, 
#     marten_P2_activity_weekdays, marten_P2_activity_weekends,
#     raccoon_P2_activity_weekdays, raccoon_P2_activity_weekends,
#     # P3
#     squirrel_P3_activity_weekdays, squirrel_P3_activity_weekends,
#     cat_P3_activity_weekdays, cat_P3_activity_weekends,
#     fox_P3_activity_weekdays, fox_P3_activity_weekends, 
#     marten_P3_activity_weekdays, marten_P3_activity_weekends,
#     raccoon_P3_activity_weekdays, raccoon_P3_activity_weekends,
#     # P4
#     squirrel_P4_activity_weekdays, squirrel_P4_activity_weekends,
#     cat_P4_activity_weekdays, cat_P4_activity_weekends,
#     fox_P4_activity_weekdays, fox_P4_activity_weekends,
#     marten_P4_activity_weekdays, marten_P4_activity_weekends,
#     raccoon_P4_activity_weekdays, raccoon_P4_activity_weekends,
#     # P5
#     squirrel_P5_activity_weekdays, squirrel_P5_activity_weekends,
#     cat_P5_activity_weekdays, cat_P5_activity_weekends,
#     fox_P5_activity_weekdays, fox_P5_activity_weekends,
#     marten_P5_activity_weekdays, marten_P5_activity_weekends, 
#     raccoon_P5_activity_weekdays, raccoon_P5_activity_weekends)
# 
# length(unique(Activity_squirrel_pred_Berlin_all_seasons$User_uid)) #669
```



### Overview
```{r}
# # 
# table(Activity_squirrel_pred_Berlin_all_seasons$species)
# 
# # 
# Activity_squirrel_pred_Berlin_all_seasons %>% 
#   group_by(species) %>%
#   dplyr::summarise(n_pics = sum(activity))
# 
# # 
# table(Activity_squirrel_pred_Berlin_all_seasons$species, Activity_squirrel_pred_Berlin_all_seasons$project_phase) 
# 
# ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, mapping = aes(x = species)) + 
#   geom_bar() + 
#   facet_grid(weekdays ~ .)
# # 0 = weekend, 1 = week
# 
# ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, mapping = aes(x = species)) + 
#   geom_bar() + 
#   facet_grid(garden_type ~ .)
# 
# ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, mapping = aes(x = species)) + 
#   geom_bar() + 
#   facet_grid(compost ~ .)
# 
# ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, 
#        mapping = aes(x = species, y = Local_tree_cover)) + 
#   geom_boxplot()
# 
# ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, 
#        mapping = aes(x = species, y = pop_100)) + 
#   geom_boxplot()
# 
# ggplot(data = Activity_squirrel_pred_Berlin_all_seasons, 
#        mapping = aes(x = species, y = imperv_100)) + 
#   geom_boxplot()
```




## - NOT USED - Squirrels only 
We build a data set only for the squirrels.
```{r squirrel data set}
# squirrels_CT <- CT_act_date_formated[CT_act_date_formated$Species == "Squirrel",]
# # add a column for the hour of the day
# squirrels_CT$hour <- hour(squirrels_CT$Time)
```

## - NOT USED - Diurnality 
Squirrels where active between 5am and 7pm. So we will filter our data for the time between 5am-7pm for the whole month divided by weekdays and weekends
```{r diurnality function}
# #function for counting the number of pictures for each species
# diurnality <- function(species, CT) # one has to insert the species and the data set for the filtering
# {
#   CT_species <- CT %>% filter(Species == species) # 
# 
#   Unique_CT <- unique(CT_species$Station)
#   l <- list(0)
#   k <- list(0)
# 
#   for(i in Unique_CT)
#     { #% of pictures taken during the day
#       l[[which(Unique_CT == i)]] <- 
#       (nrow(CT_species %>% filter(Station == i) %>% dplyr::filter(Time >= hms("05:00:00") 
#                                 & Time <= hms("19:00:00"))))/nrow(CT_species %>%
#                            filter(Station == i)) 
#       names(l)[which(Unique_CT == i)] <- as.character(i)
#       
#       #number of pictures taken during the day
#       k[[which(Unique_CT == i)]] <- 
#       (nrow(CT_species %>% filter(Station == i) %>% dplyr::filter(Time >= hms("05:00:00") 
#                                 & Time <= hms("19:00:00")))) 
#       names(k)[which(Unique_CT == i)] <- as.character(i)
# 
#        }
#    x <- data.frame(unlist(l))
#    x <- dplyr::rename(x, diurnality = unlist.l.)
#    x <- x %>% mutate(User_uid = as.numeric(rownames(x)))
#    x_covenv <- dplyr::inner_join(x = x,
#                                  y = stacked_raster_values_and_garden_CT_all_seasons_no_nas, 
#                                  by = c("User_uid" = "Station")) #merging with the covenv
# 
#    y <- data.frame(unlist(k))
#    y <- dplyr::rename(y, nbr_pictures_day = unlist.k.)
#    y <- y %>% mutate(User_uid = as.numeric(rownames(y)))
#    y_covenv <- dplyr::inner_join(x = y,
#                                  y = x_covenv) #merging with the covenv
#    return(y_covenv)
#    
# }
```


### Create a table per species per season per weekdays/weekend
```{r diurnality table}
# #P1
# squirrel_P1_diurnality_weekdays <- diurnality("Eichhörnchen", P1_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P1_diurnality_weekends <- diurnality("Eichhörnchen", P1_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P1_diurnality_weekdays <- diurnality("cat", P1_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P1_diurnality_weekends <- diurnality("cat", P1_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P1_diurnality_weekdays <- diurnality("Rotfuchs", P1_weekdays) %>%
#   mutate(species = "Fox", weekdays = 1)
# fox_P1_diurnality_weekends <- diurnality("Rotfuchs", P1_weekends) %>%
#   mutate(species = "Fox", weekdays = 0)
# 
# marten_P1_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P1_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P1_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P1_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P1_diurnality_weekdays <- diurnality("Waschbär", P1_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P1_diurnality_weekends <- diurnality("Waschbär", P1_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# #P2
# squirrel_P2_diurnality_weekdays <- diurnality("Eichhörnchen", P2_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P2_diurnality_weekends <- diurnality("Eichhörnchen", P2_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P2_diurnality_weekdays <- diurnality("cat", P2_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P2_diurnality_weekends <- diurnality("cat", P2_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P2_diurnality_weekdays <- diurnality("Rotfuchs", P2_weekdays) %>%
#   mutate(species = "Fox", weekdays = 1)
# fox_P2_diurnality_weekends <- diurnality("Rotfuchs", P2_weekends) %>%
#   mutate(species = "Fox", weekdays = 0)
# 
# marten_P2_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P2_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P2_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P2_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P2_diurnality_weekdays <- diurnality("Waschbär", P2_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P2_diurnality_weekends <- diurnality("Waschbär", P2_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# #P3
# squirrel_P3_diurnality_weekdays <- diurnality("Eichhörnchen", P3_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P3_diurnality_weekends <- diurnality("Eichhörnchen", P3_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P3_diurnality_weekdays <- diurnality("cat", P3_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P3_diurnality_weekends <- diurnality("cat", P3_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P3_diurnality_weekdays <- diurnality("Rotfuchs", P3_weekdays) %>%
#   mutate(species = "Fox", weekdays = 1)
# fox_P3_diurnality_weekends <- diurnality("Rotfuchs", P3_weekends) %>%
#   mutate(species = "Fox", weekdays = 0)
# 
# marten_P3_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P3_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P3_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P3_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P3_diurnality_weekdays <- diurnality("Waschbär", P3_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P3_diurnality_weekends <- diurnality("Waschbär", P3_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# #P4
# squirrel_P4_diurnality_weekdays <- diurnality("Eichhörnchen", P4_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P4_diurnality_weekends <- diurnality("Eichhörnchen", P4_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P4_diurnality_weekdays <- diurnality("cat", P4_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P4_diurnality_weekends <- diurnality("cat", P4_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P4_diurnality_weekdays <- diurnality("Rotfuchs", P4_weekdays) %>%
#   mutate(species = "Fox", weekdays = 1)
# fox_P4_diurnality_weekends <- diurnality("Rotfuchs", P4_weekends) %>%
#   mutate(species = "Fox", weekdays = 0)
# 
# marten_P4_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P4_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P4_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P4_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P4_diurnality_weekdays <- diurnality("Waschbär", P4_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P4_diurnality_weekends <- diurnality("Waschbär", P4_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# #P5
# squirrel_P5_diurnality_weekdays <- diurnality("Eichhörnchen", P5_weekdays) %>%
#   mutate(species = "Squirrel", weekdays = 1)
# squirrel_P5_diurnality_weekends <- diurnality("Eichhörnchen", P5_weekends) %>%
#   mutate(species = "Squirrel", weekdays = 0)
# 
# cat_P5_diurnality_weekdays <- diurnality("cat", P5_weekdays) %>%
#   mutate(species = "Cat", weekdays = 1)
# cat_P5_diurnality_weekends <- diurnality("cat", P5_weekends) %>%
#   mutate(species = "Cat", weekdays = 0)
# 
# fox_P5_diurnality_weekdays <- diurnality("Rotfuchs", P5_weekdays) %>%
#   mutate(species = "Fox", weekdays = 1)
# fox_P5_diurnality_weekends <- diurnality("Rotfuchs", P5_weekends) %>%
#   mutate(species = "Fox", weekdays = 0)
# 
# marten_P5_diurnality_weekdays <- diurnality("Marder_(Baum-und_Steinmarder)", P5_weekdays) %>%
#   mutate(species = "Marten", weekdays = 1)
# marten_P5_diurnality_weekends <- diurnality("Marder_(Baum-und_Steinmarder)", P5_weekends) %>%
#   mutate(species = "Marten", weekdays = 0)
# 
# raccoon_P5_diurnality_weekdays <- diurnality("Waschbär", P5_weekdays) %>%
#   mutate(species = "Raccoon", weekdays = 1)
# raccoon_P5_diurnality_weekends <- diurnality("Waschbär", P5_weekends) %>%
#   mutate(species = "Raccoon", weekdays = 0)
# 
# # Combine the data sets
# diurnality_predprey_Berlin_all_seasons <- 
#   rbind( # P1
#     squirrel_P1_diurnality_weekdays, squirrel_P1_diurnality_weekends,
#     cat_P1_diurnality_weekdays, cat_P1_diurnality_weekends,
#     fox_P1_diurnality_weekdays, fox_P1_diurnality_weekends, 
#     marten_P1_diurnality_weekdays, marten_P1_diurnality_weekends,
#     raccoon_P1_diurnality_weekdays, raccoon_P1_diurnality_weekends,
#     # P2
#     squirrel_P2_diurnality_weekdays, squirrel_P2_diurnality_weekends,
#     cat_P2_diurnality_weekdays, cat_P2_diurnality_weekends,
#     fox_P2_diurnality_weekdays, fox_P2_diurnality_weekends,
#     marten_P2_diurnality_weekdays, marten_P2_diurnality_weekends, 
#     raccoon_P2_diurnality_weekdays, raccoon_P2_diurnality_weekends,
#     # P3
#     squirrel_P3_diurnality_weekdays, squirrel_P3_diurnality_weekends,
#     cat_P3_diurnality_weekdays, cat_P3_diurnality_weekends,
#     fox_P3_diurnality_weekdays, fox_P3_diurnality_weekends, 
#     marten_P3_diurnality_weekdays, marten_P3_diurnality_weekends,
#     raccoon_P3_diurnality_weekdays, raccoon_P3_diurnality_weekends,
#     # P4
#     squirrel_P4_diurnality_weekdays, squirrel_P4_diurnality_weekends,
#     cat_P4_diurnality_weekdays, cat_P4_diurnality_weekends,
#     fox_P4_diurnality_weekdays, fox_P4_diurnality_weekends, 
#     marten_P4_diurnality_weekdays, marten_P4_diurnality_weekends,
#     raccoon_P4_diurnality_weekdays, raccoon_P4_diurnality_weekends,
#     # P5
#     squirrel_P5_diurnality_weekdays, squirrel_P5_diurnality_weekends,
#     cat_P5_diurnality_weekdays, cat_P5_diurnality_weekends,
#     fox_P5_diurnality_weekdays, fox_P5_diurnality_weekends,
#     marten_P5_diurnality_weekdays, marten_P5_diurnality_weekends, 
#     raccoon_P5_diurnality_weekdays, raccoon_P5_diurnality_weekends)
# 
# length(unique(diurnality_predprey_Berlin_all_seasons$User_uid))
```

Hint: it is fine that the number of rows in the datasets for activity and diurnality are the same. But the number of pictures per day per station is different
